---
title: 'Trabajar con tipos de referencia que aceptan valores NULL: EF Core'
description: Trabajar con tipos de referencia que aceptan valores NULL de C# al usar Entity Framework Core
author: roji
ms.date: 09/09/2019
uid: core/miscellaneous/nullable-reference-types
ms.openlocfilehash: 1cfba9bbe9350034ad3a63184bb00ded8e4b6a40
ms.sourcegitcommit: abda0872f86eefeca191a9a11bfca976bc14468b
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/14/2020
ms.locfileid: "90071646"
---
# <a name="working-with-nullable-reference-types"></a><span data-ttu-id="5f4b0-103">Trabajar con tipos de referencia que aceptan valores NULL</span><span class="sxs-lookup"><span data-stu-id="5f4b0-103">Working with Nullable Reference Types</span></span>

<span data-ttu-id="5f4b0-104">C# 8 presentó una nueva característica denominada [tipos de referencia que aceptan valores NULL](/dotnet/csharp/tutorials/nullable-reference-types), lo que permite anotar tipos de referencia, lo que indica si es válido para que contengan null o not.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-104">C# 8 introduced a new feature called [nullable reference types](/dotnet/csharp/tutorials/nullable-reference-types), allowing reference types to be annotated, indicating whether it is valid for them to contain null or not.</span></span> <span data-ttu-id="5f4b0-105">Si no está familiarizado con esta característica, se recomienda que se familiarice con ella leyendo los documentos de C#.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-105">If you are new to this feature, it is recommended that make yourself familiar with it by reading the C# docs.</span></span>

<span data-ttu-id="5f4b0-106">En esta página se presenta la compatibilidad de EF Core con tipos de referencia que aceptan valores NULL y se describen los procedimientos recomendados para trabajar con ellos.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-106">This page introduces EF Core's support for nullable reference types, and describes best practices for working with them.</span></span>

## <a name="required-and-optional-properties"></a><span data-ttu-id="5f4b0-107">Propiedades obligatorias y opcionales</span><span class="sxs-lookup"><span data-stu-id="5f4b0-107">Required and optional properties</span></span>

<span data-ttu-id="5f4b0-108">La documentación principal sobre las propiedades obligatorias y opcionales y su interacción con tipos de referencia que aceptan valores NULL es la página de [propiedades obligatoria y opcional](xref:core/modeling/entity-properties#required-and-optional-properties) .</span><span class="sxs-lookup"><span data-stu-id="5f4b0-108">The main documentation on required and optional properties and their interaction with nullable reference types is the [Required and Optional Properties](xref:core/modeling/entity-properties#required-and-optional-properties) page.</span></span> <span data-ttu-id="5f4b0-109">Se recomienda comenzar leyendo primero esa página.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-109">It is recommended you start out by reading that page first.</span></span>

> [!NOTE]
> <span data-ttu-id="5f4b0-110">Tenga cuidado al habilitar los tipos de referencia que aceptan valores NULL en un proyecto existente: las propiedades de tipo de referencia que se configuraron anteriormente como opcional ahora se configurarán según sea necesario, a menos que se anoten explícitamente para que acepten valores NULL.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-110">Exercise caution when enabling nullable reference types on an existing project: reference type properties which were previously configured as optional will now be configured as required, unless they are explicitly annotated to be nullable.</span></span> <span data-ttu-id="5f4b0-111">Al administrar un esquema de base de datos relacional, esto puede provocar que se generen migraciones que modifiquen la nulabilidad de la columna de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-111">When managing a relational database schema, this may cause migrations to be generated which alter the database column's nullability.</span></span>

## <a name="dbcontext-and-dbset"></a><span data-ttu-id="5f4b0-112">DbContext y DbSet</span><span class="sxs-lookup"><span data-stu-id="5f4b0-112">DbContext and DbSet</span></span>

<span data-ttu-id="5f4b0-113">Cuando se habilitan los tipos de referencia que aceptan valores NULL, el compilador de C# emite advertencias para cualquier propiedad no inicializada que no acepte valores NULL, ya que estos contendrían el valor null.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-113">When nullable reference types are enabled, the C# compiler emits warnings for any uninitialized non-nullable property, as these would contain null.</span></span> <span data-ttu-id="5f4b0-114">Como resultado, la práctica común de tener propiedades DbSet sin inicializar en un tipo de contexto generará ahora una advertencia.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-114">As a result, the common practice of having uninitialized DbSet properties on a context type will now generate a warning.</span></span> <span data-ttu-id="5f4b0-115">Esto puede corregirse de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="5f4b0-115">This can be fixed as follows:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/NullableReferenceTypesContext.cs?name=Context&highlight=3-4)]

<span data-ttu-id="5f4b0-116">Otra estrategia consiste en usar propiedades automáticas que no aceptan valores NULL, pero para inicializarlas en null, mediante el operador null-permisivo (!) para silenciar la advertencia del compilador.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-116">Another strategy is to use non-nullable auto-properties, but to initialize them to null, using the null-forgiving operator (!) to silence the compiler warning.</span></span> <span data-ttu-id="5f4b0-117">El constructor DbContext garantiza que se inicialicen todas las propiedades DbSet y que nunca se observará null en ellas.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-117">The DbContext constructor ensures that all DbSet properties will get initialized, and null will never be observed on them.</span></span>

## <a name="non-nullable-properties-and-initialization"></a><span data-ttu-id="5f4b0-118">Propiedades y inicialización que no aceptan valores NULL</span><span class="sxs-lookup"><span data-stu-id="5f4b0-118">Non-nullable properties and initialization</span></span>

<span data-ttu-id="5f4b0-119">Las advertencias del compilador para los tipos de referencia no inicializados que no aceptan valores null también son un problema para las propiedades normales en los tipos de entidad.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-119">Compiler warnings for uninitialized non-nullable reference types are also a problem for regular properties on your entity types.</span></span> <span data-ttu-id="5f4b0-120">En el ejemplo anterior, se han evitado estas advertencias mediante el [enlace de constructor](xref:core/modeling/constructors), una característica que funciona perfectamente con propiedades que no aceptan valores NULL, lo que garantiza que siempre se inicializan.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-120">In our example above, we avoided these warnings by using [constructor binding](xref:core/modeling/constructors), a feature which works perfectly with non-nullable properties, ensuring they are always initialized.</span></span> <span data-ttu-id="5f4b0-121">Sin embargo, en algunos escenarios, el enlace del constructor no es una opción: las propiedades de navegación, por ejemplo, no se pueden inicializar de esta manera.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-121">However, in some scenarios constructor binding isn't an option: navigation properties, for example, cannot be initialized in this way.</span></span>

<span data-ttu-id="5f4b0-122">Las propiedades de navegación requeridas presentan una dificultad adicional: aunque un dependiente siempre existirá para una entidad de seguridad determinada, se puede cargar o no mediante una consulta determinada, dependiendo de las necesidades en ese punto del programa ([vea los distintos patrones para cargar datos](xref:core/querying/related-data)).</span><span class="sxs-lookup"><span data-stu-id="5f4b0-122">Required navigation properties present an additional difficulty: although a dependent will always exist for a given principal, it may or may not be loaded by a particular query, depending on the needs at that point in the program ([see the different patterns for loading data](xref:core/querying/related-data)).</span></span> <span data-ttu-id="5f4b0-123">Al mismo tiempo, no es deseable que estas propiedades acepten valores NULL, ya que esto obligaría a tener acceso a ellas para comprobar si son NULL, incluso aunque se requieran.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-123">At the same time, it is undesirable to make these properties nullable, since that would force all access to them to check for null, even if they are required.</span></span>

<span data-ttu-id="5f4b0-124">Una manera de tratar estos escenarios consiste en tener una propiedad que no acepte valores NULL con un [campo de respaldo](xref:core/modeling/backing-field)que acepte valores NULL:</span><span class="sxs-lookup"><span data-stu-id="5f4b0-124">One way to deal with these scenarios, is to have a non-nullable property with a nullable [backing field](xref:core/modeling/backing-field):</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Order.cs?range=10-17)]

<span data-ttu-id="5f4b0-125">Dado que la propiedad de navegación no admite valores NULL, se configura una navegación necesaria. y, siempre y cuando la navegación se haya cargado correctamente, se podrá acceder al dependiente a través de la propiedad.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-125">Since the navigation property is non-nullable, a required navigation is configured; and as long as the navigation is properly loaded, the dependent will be accessible via the property.</span></span> <span data-ttu-id="5f4b0-126">Sin embargo, si se tiene acceso a la propiedad sin cargar primero la entidad relacionada correctamente, se inicia una excepción InvalidOperationException, ya que el contrato de la API se ha utilizado incorrectamente.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-126">If, however, the property is accessed without first properly loading the related entity, an InvalidOperationException is thrown, since the API contract has been used incorrectly.</span></span> <span data-ttu-id="5f4b0-127">Tenga en cuenta que EF debe configurarse para tener acceso siempre al campo de respaldo y no a la propiedad, ya que se basa en poder leer el valor aunque no se haya establecido. Consulte la documentación sobre [los campos de respaldo](xref:core/modeling/backing-field) para ver cómo hacerlo y considere la posibilidad de especificar `PropertyAccessMode.Field` para asegurarse de que la configuración es correcta.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-127">Note that EF must be configured to always access the backing field and not the property, as it relies on being able to read the value even when unset; consult the documentation on [backing fields](xref:core/modeling/backing-field) on how to do this, and consider specifying `PropertyAccessMode.Field` to make sure the configuration is correct.</span></span>

<span data-ttu-id="5f4b0-128">Como alternativa de terser, es posible simplemente inicializar la propiedad en NULL con la ayuda del operador null-permisivo (!):</span><span class="sxs-lookup"><span data-stu-id="5f4b0-128">As a terser alternative, it is possible to simply initialize the property to null with the help of the null-forgiving operator (!):</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Order.cs?range=19)]

<span data-ttu-id="5f4b0-129">Nunca se observará un valor nulo real excepto como resultado de un error de programación, por ejemplo, el acceso a la propiedad de navegación sin cargar correctamente la entidad relacionada.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-129">An actual null value will never be observed except as a result of a programming bug, e.g. accessing the navigation property without properly loading the related entity beforehand.</span></span>

> [!NOTE]
> <span data-ttu-id="5f4b0-130">Las navegaciones de colección, que contienen referencias a varias entidades relacionadas, siempre deben ser no NULL.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-130">Collection navigations, which contain references to multiple related entities, should always be non-nullable.</span></span> <span data-ttu-id="5f4b0-131">Una colección vacía significa que no existe ninguna entidad relacionada, pero la propia lista nunca debe ser null.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-131">An empty collection means that no related entities exist, but the list itself should never be null.</span></span>

## <a name="navigating-and-including-nullable-relationships"></a><span data-ttu-id="5f4b0-132">Navegar y incluir relaciones que aceptan valores NULL</span><span class="sxs-lookup"><span data-stu-id="5f4b0-132">Navigating and including nullable relationships</span></span>

<span data-ttu-id="5f4b0-133">Cuando se trabaja con relaciones opcionales, es posible encontrar advertencias del compilador en las que una excepción de referencia nula real sería imposible.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-133">When dealing with optional relationships, it's possible to encounter compiler warnings where an actual null reference exception would be impossible.</span></span> <span data-ttu-id="5f4b0-134">Cuando se traducen y ejecutan las consultas LINQ, EF Core garantiza que si no existe una entidad relacionada opcional, cualquier navegación a ella simplemente se omitirá, en lugar de producirse.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-134">When translating and executing your LINQ queries, EF Core guarantees that if an optional related entity does not exist, any navigation to it will simply be ignored, rather than throwing.</span></span> <span data-ttu-id="5f4b0-135">Sin embargo, el compilador no es consciente de esta garantía EF Core y genera advertencias como si la consulta LINQ se ejecutara en memoria, con LINQ to Objects.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-135">However, the compiler is unaware of this EF Core guarantee, and produces warnings as if the LINQ query were executed in memory, with LINQ to Objects.</span></span> <span data-ttu-id="5f4b0-136">Como resultado, es necesario usar el operador null-permisivo (!) para notificar al compilador que no es posible un valor null real:</span><span class="sxs-lookup"><span data-stu-id="5f4b0-136">As a result, it is necessary to use the null-forgiving operator (!) to inform the compiler that an actual null value isn't possible:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Program.cs?range=46)]

<span data-ttu-id="5f4b0-137">Se produce un problema similar al incluir varios niveles de relaciones entre las navegaciones opcionales:</span><span class="sxs-lookup"><span data-stu-id="5f4b0-137">A similar issue occurs when including multiple levels of relationships across optional navigations:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Program.cs?range=36-39&highlight=2)]

<span data-ttu-id="5f4b0-138">Si tiene que hacer esto mucho y los tipos de entidad en cuestión son principalmente (o exclusivamente) usados en consultas de EF Core, considere la posibilidad de hacer que las propiedades de navegación no acepten valores NULL y configurarlas como opcionales a través de la API fluida o las anotaciones de datos.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-138">If you find yourself doing this a lot, and the entity types in question are predominantly (or exclusively) used in EF Core queries, consider making the navigation properties non-nullable, and to configure them as optional via the Fluent API or Data Annotations.</span></span> <span data-ttu-id="5f4b0-139">Esto quitará todas las advertencias del compilador manteniendo la relación opcional; sin embargo, si las entidades se recorren fuera de EF Core, puede observar valores NULL, aunque las propiedades se anotan como que no aceptan valores NULL.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-139">This will remove all compiler warnings while keeping the relationship optional; however, if your entities are traversed outside of EF Core, you may observe null values although the properties are annotated as non-nullable.</span></span>

## <a name="limitations"></a><span data-ttu-id="5f4b0-140">Limitaciones</span><span class="sxs-lookup"><span data-stu-id="5f4b0-140">Limitations</span></span>

* <span data-ttu-id="5f4b0-141">La ingeniería inversa no admite actualmente los [tipos de referencia que aceptan valores NULL de C# 8 (NRTs)](/dotnet/csharp/tutorials/nullable-reference-types): EF Core siempre genera código de c# que supone que la característica está desactivada.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-141">Reverse engineering does not currently support [C# 8 nullable reference types (NRTs)](/dotnet/csharp/tutorials/nullable-reference-types): EF Core always generates C# code that assumes the feature is off.</span></span> <span data-ttu-id="5f4b0-142">Por ejemplo, las columnas de texto que aceptan valores NULL se scaffolding como una propiedad con `string` el tipo, no `string?` , con la API fluida o las anotaciones de datos que se usan para configurar si una propiedad es obligatoria o no.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-142">For example, nullable text columns will be scaffolded as a property with type `string` , not `string?`, with either the Fluent API or Data Annotations used to configure whether a property is required or not.</span></span> <span data-ttu-id="5f4b0-143">Puede editar el código con scaffolding y reemplazarlo con anotaciones de nulabilidad de C#.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-143">You can edit the scaffolded code and replace these with C# nullability annotations.</span></span> <span data-ttu-id="5f4b0-144">El seguimiento de la compatibilidad con scaffolding para tipos de referencia que aceptan valores NULL se realiza mediante el problema [#15520](https://github.com/aspnet/EntityFrameworkCore/issues/15520).</span><span class="sxs-lookup"><span data-stu-id="5f4b0-144">Scaffolding support for nullable reference types is tracked by issue [#15520](https://github.com/aspnet/EntityFrameworkCore/issues/15520).</span></span>
* <span data-ttu-id="5f4b0-145">La superficie de la API pública de EF Core todavía no se ha anotado para la nulabilidad (la API pública es "null-desconocen"), lo que a veces es difícil de usar cuando la característica NRT está activada.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-145">EF Core's public API surface has not yet been annotated for nullability (the public API is "null-oblivious"), making it sometimes awkward to use when the NRT feature is turned on.</span></span> <span data-ttu-id="5f4b0-146">Esto incluye principalmente los operadores Async LINQ expuestos por EF Core, como [FirstOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.firstordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_FirstOrDefaultAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_).</span><span class="sxs-lookup"><span data-stu-id="5f4b0-146">This notably includes the async LINQ operators exposed by EF Core, such as [FirstOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.firstordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_FirstOrDefaultAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_).</span></span> <span data-ttu-id="5f4b0-147">Tenemos previsto abordar esto para la versión 5,0.</span><span class="sxs-lookup"><span data-stu-id="5f4b0-147">We plan to address this for the 5.0 release.</span></span>
