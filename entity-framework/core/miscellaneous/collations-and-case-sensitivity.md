---
title: 'Intercalaciones y distinción entre mayúsculas y minúsculas: EF Core'
description: Configuración de intercalaciones y distinción de mayúsculas y minúsculas en la base de datos y consultas con Entity Framework Core
author: roji
ms.date: 04/27/2020
uid: core/miscellaneous/collations-and-case-sensitivity
ms.openlocfilehash: 48e0a6b316742dc1467134ae81f90086bb93d011
ms.sourcegitcommit: 704240349e18b6404e5a809f5b7c9d365b152e2e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/16/2021
ms.locfileid: "100543541"
---
# <a name="collations-and-case-sensitivity"></a><span data-ttu-id="436d8-103">Intercalaciones y distinción entre mayúsculas y minúsculas</span><span class="sxs-lookup"><span data-stu-id="436d8-103">Collations and Case Sensitivity</span></span>

> [!NOTE]
> <span data-ttu-id="436d8-104">Esta característica se incluyó por primera vez en EF Core 5.0.</span><span class="sxs-lookup"><span data-stu-id="436d8-104">This feature was introduced in EF Core 5.0.</span></span>

<span data-ttu-id="436d8-105">El procesamiento de texto en las bases de datos puede ser un proceso complejo y requiere más atención al usuario de que se sospeche.</span><span class="sxs-lookup"><span data-stu-id="436d8-105">Text processing in databases can be a complex, and requires more user attention that one would suspect.</span></span> <span data-ttu-id="436d8-106">Por un lado, las bases de datos varían considerablemente en el modo en que controlan el texto; por ejemplo, mientras que algunas bases de datos distinguen mayúsculas de minúsculas de forma predeterminada (por ejemplo, SQLite, PostgreSQL), otras no distinguen mayúsculas de minúsculas (SQL Server, MySQL).</span><span class="sxs-lookup"><span data-stu-id="436d8-106">For one thing, databases vary considerably in how they handle text; for example, while some databases are case-sensitive by default (e.g. Sqlite, PostgreSQL), others are case-insensitive (SQL Server, MySQL).</span></span> <span data-ttu-id="436d8-107">Además, debido al uso de índices, la distinción de mayúsculas y minúsculas y los aspectos similares pueden tener un impacto de gran alcance en el rendimiento de las consultas: aunque puede ser tentador utilizar `string.Lower` para forzar una comparación sin distinción entre mayúsculas y minúsculas en una base de datos que distingue mayúsculas de minúsculas, si lo hace, puede evitar que la aplicación use índices.</span><span class="sxs-lookup"><span data-stu-id="436d8-107">In addition, because of index usage, case-sensitivity and similar aspects can have a far-reaching impact on query performance: while it may be tempting to use `string.Lower` to force a case-insensitive comparison in a case-sensitive database, doing so may prevent your application from using indexes.</span></span> <span data-ttu-id="436d8-108">En esta página se detalla cómo configurar la distinción de mayúsculas y minúsculas, o más en general, las intercalaciones y cómo hacerlo de manera eficaz sin poner en peligro el rendimiento de las consultas.</span><span class="sxs-lookup"><span data-stu-id="436d8-108">This page details how to configure case sensitivity, or more generally, collations, and how to do so in an efficient way without compromising query performance.</span></span>

## <a name="introduction-to-collations"></a><span data-ttu-id="436d8-109">Introducción a las intercalaciones</span><span class="sxs-lookup"><span data-stu-id="436d8-109">Introduction to collations</span></span>

<span data-ttu-id="436d8-110">Un concepto fundamental en el procesamiento de texto es la *Intercalación*, que es un conjunto de reglas que determinan cómo se ordenan y comparan la igualdad de los valores de texto.</span><span class="sxs-lookup"><span data-stu-id="436d8-110">A fundamental concept in text processing is the *collation*, which is a set of rules determining how text values are ordered and compared for equality.</span></span> <span data-ttu-id="436d8-111">Por ejemplo, mientras que una intercalación que no distingue entre mayúsculas y minúsculas no tiene en cuenta las diferencias entre las letras mayúsculas y minúsculas para los fines de la comparación de igualdad, una intercalación que distingue entre mayúsculas y minúsculas no lo hace.</span><span class="sxs-lookup"><span data-stu-id="436d8-111">For example, while a case-insensitive collation disregards differences between upper- and lower-case letters for the purposes of equality comparison, a case-sensitive collation does not.</span></span> <span data-ttu-id="436d8-112">Sin embargo, dado que la distinción de mayúsculas y minúsculas es dependiente de la referencia cultural (por ejemplo, `i` y `I` representa una letra diferente en Turco), existen varias intercalaciones que distinguen entre mayúsculas y minúsculas, cada una con su propio conjunto de reglas.</span><span class="sxs-lookup"><span data-stu-id="436d8-112">However, since case-sensitivity is culture-sensitive (e.g. `i` and `I` represent different letter in Turkish), there exist multiple case-insensitive collations, each with its own set of rules.</span></span> <span data-ttu-id="436d8-113">El ámbito de las intercalaciones también se extiende más allá de la distinción entre mayúsculas y minúsculas y otros aspectos de los datos de caracteres. en alemán, por ejemplo, a veces es conveniente tratar (pero no siempre) `ä` `ae` como idéntico.</span><span class="sxs-lookup"><span data-stu-id="436d8-113">The scope of collations also extends beyond case-sensitivity, to other aspects of character data; in German, for example, it is sometimes (but not always) desirable to treat `ä` and `ae` as identical.</span></span> <span data-ttu-id="436d8-114">Por último, las intercalaciones también definen cómo se *ordenan* los valores de texto: mientras que el alemán coloca `ä` después `a` de, sueco lo coloca al final del alfabeto.</span><span class="sxs-lookup"><span data-stu-id="436d8-114">Finally, collations also define how text values are *ordered*: while German places `ä` after `a`, Swedish places it at the end of the alphabet.</span></span>

<span data-ttu-id="436d8-115">Todas las operaciones de texto en una base de datos utilizan una intercalación, ya sea explícita o implícitamente, para determinar cómo la operación compara y ordena las cadenas.</span><span class="sxs-lookup"><span data-stu-id="436d8-115">All text operations in a database use a collation - whether explicitly or implicitly - to determine how the operation compares and orders strings.</span></span> <span data-ttu-id="436d8-116">La lista real de intercalaciones disponibles y sus esquemas de nomenclatura son específicos de la base de datos; consulte [la sección siguiente](#database-specific-information) para obtener vínculos a las páginas de documentación relevantes de varias bases de datos.</span><span class="sxs-lookup"><span data-stu-id="436d8-116">The actual list of available collations and their naming schemes is database-specific; consult [the section below](#database-specific-information) for links to relevant documentation pages of various databases.</span></span> <span data-ttu-id="436d8-117">Afortunadamente, la base de datos normalmente permite definir una intercalación predeterminada en el nivel de base de datos o de columna, y especificar explícitamente qué intercalación debe usarse para las operaciones específicas en una consulta.</span><span class="sxs-lookup"><span data-stu-id="436d8-117">Fortunately, database do generally allow a default collation to be defined at the database or column level, and to explicitly specify which collation should be use for specific operations in a query.</span></span>

## <a name="database-collation"></a><span data-ttu-id="436d8-118">Intercalación de base de datos</span><span class="sxs-lookup"><span data-stu-id="436d8-118">Database collation</span></span>

<span data-ttu-id="436d8-119">En la mayoría de los sistemas de base de datos, se define una intercalación predeterminada en el nivel de base de datos; a menos que se invalide, esa intercalación se aplica implícitamente a todas las operaciones de texto que se producen dentro de esa base de datos.</span><span class="sxs-lookup"><span data-stu-id="436d8-119">In most database systems, a default collation is defined at the database level; unless overridden, that collation implicitly applies to all text operations occurring within that database.</span></span> <span data-ttu-id="436d8-120">La intercalación de base de datos se establece normalmente en el momento de creación de la base de datos (mediante la `CREATE DATABASE` instrucción DDL) y, si no se especifica, el valor predeterminado es un valor de nivel de servidor determinado en el momento de la instalación.</span><span class="sxs-lookup"><span data-stu-id="436d8-120">The database collation is typically set at database creation time (via the `CREATE DATABASE` DDL statement), and if not specified, defaults to a some server-level value determined at setup time.</span></span> <span data-ttu-id="436d8-121">Por ejemplo, la intercalación de nivel de servidor predeterminada en SQL Server es `SQL_Latin1_General_CP1_CI_AS` , que es una intercalación que distingue entre mayúsculas y minúsculas y con distinción de acentos.</span><span class="sxs-lookup"><span data-stu-id="436d8-121">For example, the default server-level collation in SQL Server is `SQL_Latin1_General_CP1_CI_AS`, which is a case-insensitive, accent-sensitive collation.</span></span> <span data-ttu-id="436d8-122">Aunque los sistemas de base de datos normalmente permiten modificar la intercalación de una base de datos existente, hacerlo puede provocar complicaciones; se recomienda elegir una intercalación antes de la creación de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="436d8-122">Although database systems usually do permit altering the collation of an existing database, doing so can lead to complications; it is recommended to pick a collation before database creation.</span></span>

<span data-ttu-id="436d8-123">Al usar migraciones de EF Core para administrar el esquema de la base de datos, lo siguiente en el método del modelo `OnModelCreating` configura una base de datos SQL Server para que use una intercalación que distinga entre mayúsculas y minúsculas:</span><span class="sxs-lookup"><span data-stu-id="436d8-123">When using EF Core migrations to manage your database schema, the following in your model's `OnModelCreating` method configures a SQL Server database to use a case-sensitive collation:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?name=DatabaseCollation)]

## <a name="column-collation"></a><span data-ttu-id="436d8-124">Intercalación de columnas</span><span class="sxs-lookup"><span data-stu-id="436d8-124">Column collation</span></span>

<span data-ttu-id="436d8-125">Las intercalaciones también se pueden definir en columnas de texto, invalidando el valor predeterminado de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="436d8-125">Collations can also be defined on text columns, overriding the database default.</span></span> <span data-ttu-id="436d8-126">Esto puede ser útil si algunas columnas deben distinguir entre mayúsculas y minúsculas, mientras que el resto de la base de datos debe distinguir entre mayúsculas y minúsculas.</span><span class="sxs-lookup"><span data-stu-id="436d8-126">This can be useful if certain columns need to be case-insensitive, while the rest of the database needs to be case-sensitive.</span></span>

<span data-ttu-id="436d8-127">Al usar migraciones de EF Core para administrar el esquema de la base de datos, lo siguiente configura la columna para `Name` que la propiedad no distinga entre mayúsculas y minúsculas en una base de datos que, de otro modo, está configurada para distinguir entre mayúsculas y minúsculas:</span><span class="sxs-lookup"><span data-stu-id="436d8-127">When using EF Core migrations to manage your database schema, the following configures the column for the `Name` property to be case-insensitive in a database that is otherwise configured to be case-sensitive:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?name=ColumnCollation)]

## <a name="explicit-collation-in-a-query"></a><span data-ttu-id="436d8-128">Intercalación explícita en una consulta</span><span class="sxs-lookup"><span data-stu-id="436d8-128">Explicit collation in a query</span></span>

<span data-ttu-id="436d8-129">En algunos casos, la misma columna debe consultarse utilizando distintas intercalaciones en consultas diferentes.</span><span class="sxs-lookup"><span data-stu-id="436d8-129">In some cases, the same column needs to be queried using different collations by different queries.</span></span> <span data-ttu-id="436d8-130">Por ejemplo, una consulta puede necesitar realizar una comparación con distinción entre mayúsculas y minúsculas en una columna, mientras que otra puede necesitar realizar una comparación sin distinción entre mayúsculas y minúsculas en la misma columna.</span><span class="sxs-lookup"><span data-stu-id="436d8-130">For example, one query may need to perform a case-sensitive comparison on a column, while another may need to perform a case-insensitive comparison on the same column.</span></span> <span data-ttu-id="436d8-131">Esto puede realizarse especificando explícitamente una intercalación dentro de la propia consulta:</span><span class="sxs-lookup"><span data-stu-id="436d8-131">This can be accomplished by explicitly specifying a collation within the query itself:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?name=SimpleQueryCollation)]

<span data-ttu-id="436d8-132">Esto genera una `COLLATE` cláusula en la consulta SQL, que aplica una intercalación que distingue entre mayúsculas y minúsculas, independientemente de la intercalación definida en el nivel de columna o de base de datos:</span><span class="sxs-lookup"><span data-stu-id="436d8-132">This generates a `COLLATE` clause in the SQL query, which applies a case-sensitive collation regardless of the collation defined at the column or database level:</span></span>

```sql
SELECT [c].[Id], [c].[Name]
FROM [Customers] AS [c]
WHERE [c].[Name] COLLATE SQL_Latin1_General_CP1_CS_AS = N'John'
```

### <a name="explicit-collations-and-indexes"></a><span data-ttu-id="436d8-133">Intercalaciones e índices explícitos</span><span class="sxs-lookup"><span data-stu-id="436d8-133">Explicit collations and indexes</span></span>

<span data-ttu-id="436d8-134">Los índices son uno de los factores más importantes en el rendimiento de la base de datos: una consulta que se ejecuta eficazmente con un índice puede triturarse en una detención sin ese índice.</span><span class="sxs-lookup"><span data-stu-id="436d8-134">Indexes are one of the most important factors in database performance - a query that runs efficiently with an index can grind to a halt without that index.</span></span> <span data-ttu-id="436d8-135">Los índices heredan implícitamente la intercalación de su columna; Esto significa que todas las consultas de la columna son válidas automáticamente para usar índices definidos en esa columna, siempre que la consulta no especifique una intercalación diferente.</span><span class="sxs-lookup"><span data-stu-id="436d8-135">Indexes implicitly inherit the collation of their column; this means that all queries on the column are automatically eligible to use indexes defined on that column - provided that the query doesn't specify a different collation.</span></span> <span data-ttu-id="436d8-136">Especificar una intercalación explícita en una consulta normalmente impedirá que la consulta use un índice definido en esa columna, ya que las intercalaciones dejarán de coincidir; por lo tanto, se recomienda tener cuidado al usar esta característica.</span><span class="sxs-lookup"><span data-stu-id="436d8-136">Specifying an explicit collation in a query will generally prevent that query from using an index defined on that column, since the collations would no longer match; it is therefore recommended to exercise caution when using this feature.</span></span> <span data-ttu-id="436d8-137">Siempre es preferible definir la intercalación en el nivel de columna (o base de datos), lo que permite que todas las consultas utilicen implícitamente esa intercalación y se beneficien de cualquier índice.</span><span class="sxs-lookup"><span data-stu-id="436d8-137">It is always preferable to define the collation at the column (or database) level, allowing all queries to implicitly use that collation and benefit from any index.</span></span>

<span data-ttu-id="436d8-138">Tenga en cuenta que algunas bases de datos permiten definir la intercalación al crear un índice (por ejemplo, PostgreSQL, SQLite).</span><span class="sxs-lookup"><span data-stu-id="436d8-138">Note that some databases allow the collation to be defined when creating an index (e.g. PostgreSQL, Sqlite).</span></span> <span data-ttu-id="436d8-139">Esto permite definir varios índices en la misma columna, con lo que se aceleran las operaciones con diferentes intercalaciones (por ejemplo, comparaciones que distinguen mayúsculas de minúsculas y no distinguen mayúsculas de minúsculas).</span><span class="sxs-lookup"><span data-stu-id="436d8-139">This allows multiple indexes to be defined on the same column, speeding up operations with different collations (e.g. both case-sensitive and case-insensitive comparisons).</span></span> <span data-ttu-id="436d8-140">Consulte la documentación del proveedor de bases de datos para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="436d8-140">Consult your database provider's documentation for more details.</span></span>

> [!WARNING]
> <span data-ttu-id="436d8-141">Inspeccione siempre los planes de consulta de las consultas y asegúrese de que se usan los índices adecuados en las consultas críticas para el rendimiento que se ejecutan en grandes cantidades de datos.</span><span class="sxs-lookup"><span data-stu-id="436d8-141">Always inspect the query plans of your queries, and make sure the proper indexes are being used in performance-critical queries executing over large amounts of data.</span></span> <span data-ttu-id="436d8-142">Reemplazar la distinción de mayúsculas y minúsculas en una consulta mediante `EF.Functions.Collate` (o llamando a `string.ToLower` ) puede tener un impacto muy significativo en el rendimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="436d8-142">Overriding case-sensitivity in a query via `EF.Functions.Collate` (or by calling `string.ToLower`) can have a very significant impact on your application's performance.</span></span>

## <a name="translation-of-built-in-net-string-operations"></a><span data-ttu-id="436d8-143">Traducción de operaciones de cadena integradas de .NET</span><span class="sxs-lookup"><span data-stu-id="436d8-143">Translation of built-in .NET string operations</span></span>

<span data-ttu-id="436d8-144">En .NET, la igualdad de cadena distingue entre mayúsculas y minúsculas de forma predeterminada: `s1 == s2` realiza una comparación ordinal que requiere que las cadenas sean idénticas.</span><span class="sxs-lookup"><span data-stu-id="436d8-144">In .NET, string equality is case-sensitive by default: `s1 == s2` performs an ordinal comparison that requires the strings to be identical.</span></span> <span data-ttu-id="436d8-145">Dado que la intercalación predeterminada de las bases de datos varía y porque es deseable para la igualdad simple usar índices, EF Core no intenta traducir la igualdad simple a una operación que distingue entre mayúsculas y minúsculas: la igualdad de C# se traduce directamente a la igualdad de SQL, que puede o no distinguir mayúsculas de minúsculas, según la base de datos específica en uso y su configuración de</span><span class="sxs-lookup"><span data-stu-id="436d8-145">Because the default collation of databases varies, and because it is desirable for simple equality to use indexes, EF Core makes no attempt to translate simple equality to a database case-sensitive operation: C# equality is translated directly to SQL equality, which may or may not be case-sensitive, depending on the specific database in use and its collation configuration.</span></span>

<span data-ttu-id="436d8-146">Además, .NET proporciona sobrecargas [`string.Equals`](/dotnet/api/system.string.equals#System_String_Equals_System_String_System_StringComparison_) para aceptar una [`StringComparison`](/dotnet/api/system.stringcomparison) enumeración, que permite especificar la distinción de mayúsculas y minúsculas y la referencia cultural de la comparación.</span><span class="sxs-lookup"><span data-stu-id="436d8-146">In addition, .NET provides overloads of [`string.Equals`](/dotnet/api/system.string.equals#System_String_Equals_System_String_System_StringComparison_) accepting a [`StringComparison`](/dotnet/api/system.stringcomparison) enum, which allows specifying case-sensitivity and culture for the comparison.</span></span> <span data-ttu-id="436d8-147">Por diseño, EF Core se abstendrán de traducir estas sobrecargas a SQL y se producirá una excepción al intentar usarlas.</span><span class="sxs-lookup"><span data-stu-id="436d8-147">By design, EF Core refrains from translating these overloads to SQL, and attempting to use them will result in an exception.</span></span> <span data-ttu-id="436d8-148">En un caso, EF Core no sabe qué intercalación que distingue entre mayúsculas y minúsculas o que no distingue mayúsculas de minúsculas.</span><span class="sxs-lookup"><span data-stu-id="436d8-148">For one thing, EF Core does know not which case-sensitive or case-insensitive collation should be used.</span></span> <span data-ttu-id="436d8-149">Lo que es más importante, al aplicar una intercalación en la mayoría de los casos, se evita el uso del índice, lo que afecta significativamente al rendimiento de una construcción .NET muy básica y de uso frecuente.</span><span class="sxs-lookup"><span data-stu-id="436d8-149">More importantly, applying a collation would in most cases prevent index usage, significantly impacting performance for a very basic and commonly-used .NET construct.</span></span> <span data-ttu-id="436d8-150">Para forzar que una consulta use la comparación con distinción de mayúsculas y minúsculas o sin distinción de mayúsculas y minúsculas, especifique una intercalación explícitamente mediante `EF.Functions.Collate` como se [detailó anteriormente](#explicit-collations-and-indexes).</span><span class="sxs-lookup"><span data-stu-id="436d8-150">To force a query to use case-sensitive or case-insensitive comparison, specify a collation explicitly via `EF.Functions.Collate` as [detailed above](#explicit-collations-and-indexes).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="436d8-151">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="436d8-151">Additional resources</span></span>

### <a name="database-specific-information"></a><span data-ttu-id="436d8-152">Información específica de la base de datos</span><span class="sxs-lookup"><span data-stu-id="436d8-152">Database-specific information</span></span>

* <span data-ttu-id="436d8-153">[SQL Server documentación sobre las intercalaciones](/sql/relational-databases/collations/collation-and-unicode-support).</span><span class="sxs-lookup"><span data-stu-id="436d8-153">[SQL Server documentation on collations](/sql/relational-databases/collations/collation-and-unicode-support).</span></span>
* <span data-ttu-id="436d8-154">[Documentación de Microsoft. Data. SQLite sobre las intercalaciones](/dotnet/standard/data/sqlite/collation).</span><span class="sxs-lookup"><span data-stu-id="436d8-154">[Microsoft.Data.Sqlite documentation on collations](/dotnet/standard/data/sqlite/collation).</span></span>
* <span data-ttu-id="436d8-155">[Documentación de PostgreSQL sobre las intercalaciones](https://www.postgresql.org/docs/current/collation.html).</span><span class="sxs-lookup"><span data-stu-id="436d8-155">[PostgreSQL documentation on collations](https://www.postgresql.org/docs/current/collation.html).</span></span>
* <span data-ttu-id="436d8-156">[Documentación de MySQL sobre intercalaciones](https://dev.mysql.com/doc/refman/en/charset-general.html).</span><span class="sxs-lookup"><span data-stu-id="436d8-156">[MySQL documentation on collations](https://dev.mysql.com/doc/refman/en/charset-general.html).</span></span>

### <a name="other-resources"></a><span data-ttu-id="436d8-157">Otros recursos</span><span class="sxs-lookup"><span data-stu-id="436d8-157">Other resources</span></span>

* <span data-ttu-id="436d8-158">[EF Core sesión reunión](https://www.youtube.com/watch?v=OgMhLVa_VfA&list=PLdo4fOcmZ0oX-DBuRG4u58ZTAJgBAeQ-t&index=1)de la comunidad, introducción a las intercalaciones y exploración de los aspectos de rendimiento e indexación.</span><span class="sxs-lookup"><span data-stu-id="436d8-158">[EF Core Community Standup session](https://www.youtube.com/watch?v=OgMhLVa_VfA&list=PLdo4fOcmZ0oX-DBuRG4u58ZTAJgBAeQ-t&index=1), introducing collations and exploring perf and indexing aspects.</span></span>
