---
title: 'Actualización de versiones anteriores a EF Core 2: EF Core'
description: Instrucciones y notas para actualizar a Entity Framework Core 2.0
author: divega
ms.date: 08/13/2017
ms.assetid: 8BD43C8C-63D9-4F3A-B954-7BC518A1B7DB
uid: core/what-is-new/ef-core-2.0/upgrade
ms.openlocfilehash: 2bd88c0c52bcef8d5a9777f2cbd546a2787d67a9
ms.sourcegitcommit: 7c3939504bb9da3f46bea3443638b808c04227c2
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 09/09/2020
ms.locfileid: "89620693"
---
# <a name="upgrading-applications-from-previous-versions-to-ef-core-20"></a><span data-ttu-id="a39c3-103">Actualización de las aplicaciones de las versiones anteriores a EF Core 2.0</span><span class="sxs-lookup"><span data-stu-id="a39c3-103">Upgrading applications from previous versions to EF Core 2.0</span></span>

<span data-ttu-id="a39c3-104">Hemos aprovechado la oportunidad de pulir bastante las API y los comportamientos existentes en la versión 2.0.</span><span class="sxs-lookup"><span data-stu-id="a39c3-104">We have taken the opportunity to significantly refine our existing APIs and behaviors in 2.0.</span></span> <span data-ttu-id="a39c3-105">Hay algunas mejoras que pueden requerir la modificación del código existente de las aplicaciones, aunque creemos que para casi todas el impacto será bajo. En la mayoría de casos, para reemplazar las API obsoletas solo es necesario volver a efectuar la compilación y realizar unos cambios mínimos guiados.</span><span class="sxs-lookup"><span data-stu-id="a39c3-105">There are a few improvements that can require modifying existing application code, although we believe that for the majority of applications the impact will be low, in most cases requiring just recompilation and minimal guided changes to replace obsolete APIs.</span></span>

<span data-ttu-id="a39c3-106">La actualización de una aplicación existente a EF Core 2.0 puede requerir lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="a39c3-106">Updating an existing application to EF Core 2.0 may require:</span></span>

1. <span data-ttu-id="a39c3-107">Actualizar la implementación de la aplicación .NET de destino a una que admita .NET Standard 2.0.</span><span class="sxs-lookup"><span data-stu-id="a39c3-107">Upgrading the target .NET implementation of the application to one that supports .NET Standard 2.0.</span></span> <span data-ttu-id="a39c3-108">Vea [Implementaciones de .NET compatibles](xref:core/platforms/index) para obtener más detalles.</span><span class="sxs-lookup"><span data-stu-id="a39c3-108">See [Supported .NET Implementations](xref:core/platforms/index) for more details.</span></span>

2. <span data-ttu-id="a39c3-109">Identificar un proveedor para la base de datos de destino que sea compatible con EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="a39c3-109">Identify a provider for the target database which is compatible with EF Core 2.0.</span></span> <span data-ttu-id="a39c3-110">Vea debajo [EF Core 2.0 requiere un proveedor de base de datos 2.0](#ef-core-20-requires-a-20-database-provider).</span><span class="sxs-lookup"><span data-stu-id="a39c3-110">See [EF Core 2.0 requires a 2.0 database provider](#ef-core-20-requires-a-20-database-provider) below.</span></span>

3. <span data-ttu-id="a39c3-111">Actualizar todos los paquetes de EF Core (entorno de ejecución y herramientas) a la versión 2.0.</span><span class="sxs-lookup"><span data-stu-id="a39c3-111">Upgrading all the EF Core packages (runtime and tooling) to 2.0.</span></span> <span data-ttu-id="a39c3-112">Consulte [Instalación de EF Core](xref:core/get-started/install/index) para obtener información detallada.</span><span class="sxs-lookup"><span data-stu-id="a39c3-112">Refer to [Installing EF Core](xref:core/get-started/install/index) for more details.</span></span>

4. <span data-ttu-id="a39c3-113">Realizar los cambios de código necesarios para compensar los cambios importantes descritos en el resto de este documento.</span><span class="sxs-lookup"><span data-stu-id="a39c3-113">Make any necessary code changes to compensate for the breaking changes described in the rest of this document.</span></span>

## <a name="aspnet-core-now-includes-ef-core"></a><span data-ttu-id="a39c3-114">EF Core, ahora incluido en ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="a39c3-114">ASP.NET Core now includes EF Core</span></span>

<span data-ttu-id="a39c3-115">Las aplicaciones para ASP.NET Core 2.0 pueden usar EF Core 2.0 sin dependencias adicionales además de proveedores de bases de datos de terceros.</span><span class="sxs-lookup"><span data-stu-id="a39c3-115">Applications targeting ASP.NET Core 2.0 can use EF Core 2.0 without additional dependencies besides third party database providers.</span></span> <span data-ttu-id="a39c3-116">Sin embargo, las aplicaciones destinadas a versiones anteriores de ASP.NET Core deben actualizarse a ASP.NET Core 2.0 para usar EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="a39c3-116">However, applications targeting previous versions of ASP.NET Core need to upgrade to ASP.NET Core 2.0 in order to use EF Core 2.0.</span></span> <span data-ttu-id="a39c3-117">Para obtener información detallada sobre la actualización de aplicaciones ASP.NET Core a la versión 2.0, vea la [documentación de ASP.NET Core sobre el tema](/aspnet/core/migration/1x-to-2x/).</span><span class="sxs-lookup"><span data-stu-id="a39c3-117">For more details on upgrading ASP.NET Core applications to 2.0 see [the ASP.NET Core documentation on the subject](/aspnet/core/migration/1x-to-2x/).</span></span>

## <a name="new-way-of-getting-application-services-in-aspnet-core"></a><span data-ttu-id="a39c3-118">Nueva forma de obtener servicios de aplicación en ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="a39c3-118">New way of getting application services in ASP.NET Core</span></span>

<span data-ttu-id="a39c3-119">El patrón recomendado para las aplicaciones web de ASP.NET Core se ha actualizado a la versión 2.0 de un modo que ha afectado a la lógica de EF Core en tiempo de diseño utilizada en las versiones 1.x.</span><span class="sxs-lookup"><span data-stu-id="a39c3-119">The recommended pattern for ASP.NET Core web applications has been updated for 2.0 in a way that broke the design-time logic EF Core used in 1.x.</span></span> <span data-ttu-id="a39c3-120">Anteriormente, en tiempo de diseño, EF Core intentaba invocar `Startup.ConfigureServices` directamente para acceder al proveedor de servicios de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a39c3-120">Previously at design-time, EF Core would try to invoke `Startup.ConfigureServices` directly in order to access the application's service provider.</span></span> <span data-ttu-id="a39c3-121">En ASP.NET Core 2.0, la configuración se inicializa fuera de la clase `Startup`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-121">In ASP.NET Core 2.0, Configuration is initialized outside of the `Startup` class.</span></span> <span data-ttu-id="a39c3-122">Las aplicaciones que usan EF Core normalmente acceden a su cadena de conexión desde la configuración, por lo que `Startup` en sí ya no es suficiente.</span><span class="sxs-lookup"><span data-stu-id="a39c3-122">Applications using EF Core typically access their connection string from Configuration, so `Startup` by itself is no longer sufficient.</span></span> <span data-ttu-id="a39c3-123">Si actualiza una aplicación ASP.NET Core 1.x, es posible que reciba el error siguiente al usar las herramientas de EF Core.</span><span class="sxs-lookup"><span data-stu-id="a39c3-123">If you upgrade an ASP.NET Core 1.x application, you may receive the following error when using the EF Core tools.</span></span>

> <span data-ttu-id="a39c3-124">No se encontró ningún constructor sin parámetros en "ApplicationContext".</span><span class="sxs-lookup"><span data-stu-id="a39c3-124">No parameterless constructor was found on 'ApplicationContext'.</span></span> <span data-ttu-id="a39c3-125">Agregue un constructor sin parámetros a "ApplicationContext" o agregue una implementación de "IDesignTimeDbContextFactory&lt;ApplicationContext&gt;" en el mismo ensamblado que "ApplicationContext".</span><span class="sxs-lookup"><span data-stu-id="a39c3-125">Either add a parameterless constructor to 'ApplicationContext' or add an implementation of 'IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' in the same assembly as 'ApplicationContext'</span></span>

<span data-ttu-id="a39c3-126">Se ha agregado un nuevo enlace en tiempo de diseño en la plantilla predeterminada de ASP.NET Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="a39c3-126">A new design-time hook has been added in ASP.NET Core 2.0's default template.</span></span> <span data-ttu-id="a39c3-127">El método `Program.BuildWebHost` estático permite a EF Core acceder al proveedor de servicios de la aplicación en tiempo de diseño.</span><span class="sxs-lookup"><span data-stu-id="a39c3-127">The static `Program.BuildWebHost` method enables EF Core to access the application's service provider at design time.</span></span> <span data-ttu-id="a39c3-128">Si va a actualizar una aplicación ASP.NET Core 1.x, deberá actualizar la clase `Program` para que se parezca a lo siguiente.</span><span class="sxs-lookup"><span data-stu-id="a39c3-128">If you are upgrading an ASP.NET Core 1.x application, you will need to update the `Program` class to resemble the following.</span></span>

``` csharp
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;

namespace AspNetCoreDotNetCore2._0App
{
    public class Program
    {
        public static void Main(string[] args)
        {
            BuildWebHost(args).Run();
        }

        public static IWebHost BuildWebHost(string[] args) =>
            WebHost.CreateDefaultBuilder(args)
                .UseStartup<Startup>()
                .Build();
    }
}
```

<span data-ttu-id="a39c3-129">La adopción de este patrón nuevo al actualizar aplicaciones a la versión 2.0 es muy recomendable y necesaria para que funcionen características de producto como las migraciones de Entity Framework Core.</span><span class="sxs-lookup"><span data-stu-id="a39c3-129">The adoption of this new pattern when updating applications to 2.0 is highly recommended and is required in order for product features like Entity Framework Core Migrations to work.</span></span> <span data-ttu-id="a39c3-130">La otra alternativa común es [implementar *IDesignTimeDbContextFactory\<TContext>* ](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span><span class="sxs-lookup"><span data-stu-id="a39c3-130">The other common alternative is to [implement *IDesignTimeDbContextFactory\<TContext>*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span></span>

## <a name="idbcontextfactory-renamed"></a><span data-ttu-id="a39c3-131">Cambio de nombre de IDbContextFactory</span><span class="sxs-lookup"><span data-stu-id="a39c3-131">IDbContextFactory renamed</span></span>

<span data-ttu-id="a39c3-132">Con el fin de admitir varios patrones de aplicación y proporcionar a los usuarios un mayor control sobre cómo se utiliza su `DbContext` en tiempo de diseño, en el pasado se ofrecía la interfaz `IDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-132">In order to support diverse application patterns and give users more control over how their `DbContext` is used at design time, we have, in the past, provided the `IDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="a39c3-133">En tiempo de diseño, las herramientas de EF Core detectarán las implementaciones de esta interfaz en el proyecto y la usarán para crear objetos `DbContext`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-133">At design-time, the EF Core tools will discover implementations of this interface in your project and use it to create `DbContext` objects.</span></span>

<span data-ttu-id="a39c3-134">Esta interfaz tenía un nombre muy general y confuso para algunos usuarios, quienes acababan intentando reutilizarlo para otros escenarios de creación de `DbContext`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-134">This interface had a very general name which mislead some users to try re-using it for other `DbContext`-creating scenarios.</span></span> <span data-ttu-id="a39c3-135">No estaban protegidos cuando las herramientas de EF intentaban usar su implementación en tiempo de diseño y provocaban que se produjera un error en comandos como `Update-Database` o `dotnet ef database update`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-135">They were caught off guard when the EF Tools then tried to use their implementation at design-time and caused commands like `Update-Database` or `dotnet ef database update` to fail.</span></span>

<span data-ttu-id="a39c3-136">Con el fin de comunicar la semántica sólida en tiempo de diseño de esta interfaz, se le ha cambiado el nombre a `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-136">In order to communicate the strong design-time semantics of this interface, we have renamed it to `IDesignTimeDbContextFactory<TContext>`.</span></span>

<span data-ttu-id="a39c3-137">En la versión 2.0, `IDbContextFactory<TContext>` todavía existe, pero está marcado como obsoleto.</span><span class="sxs-lookup"><span data-stu-id="a39c3-137">For the 2.0 release the `IDbContextFactory<TContext>` still exists but is marked as obsolete.</span></span>

## <a name="dbcontextfactoryoptions-removed"></a><span data-ttu-id="a39c3-138">Eliminación de DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="a39c3-138">DbContextFactoryOptions removed</span></span>

<span data-ttu-id="a39c3-139">Debido a los cambios en ASP.NET Core 2.0 descritos anteriormente, encontramos que `DbContextFactoryOptions` ya no era necesario en la nueva interfaz de `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-139">Because of the ASP.NET Core 2.0 changes described above, we found that `DbContextFactoryOptions` was no longer needed on the new `IDesignTimeDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="a39c3-140">Estas son las alternativas que debe usar en su lugar.</span><span class="sxs-lookup"><span data-stu-id="a39c3-140">Here are the alternatives you should be using instead.</span></span>

| <span data-ttu-id="a39c3-141">DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="a39c3-141">DbContextFactoryOptions</span></span> | <span data-ttu-id="a39c3-142">Alternativa</span><span class="sxs-lookup"><span data-stu-id="a39c3-142">Alternative</span></span>                                                  |
|:------------------------|:-------------------------------------------------------------|
| <span data-ttu-id="a39c3-143">ApplicationBasePath</span><span class="sxs-lookup"><span data-stu-id="a39c3-143">ApplicationBasePath</span></span>     | <span data-ttu-id="a39c3-144">AppContext.BaseDirectory</span><span class="sxs-lookup"><span data-stu-id="a39c3-144">AppContext.BaseDirectory</span></span>                                     |
| <span data-ttu-id="a39c3-145">ContentRootPath</span><span class="sxs-lookup"><span data-stu-id="a39c3-145">ContentRootPath</span></span>         | <span data-ttu-id="a39c3-146">Directory.GetCurrentDirectory()</span><span class="sxs-lookup"><span data-stu-id="a39c3-146">Directory.GetCurrentDirectory()</span></span>                              |
| <span data-ttu-id="a39c3-147">EnvironmentName</span><span class="sxs-lookup"><span data-stu-id="a39c3-147">EnvironmentName</span></span>         | <span data-ttu-id="a39c3-148">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span><span class="sxs-lookup"><span data-stu-id="a39c3-148">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span></span> |

## <a name="design-time-working-directory-changed"></a><span data-ttu-id="a39c3-149">Cambio del directorio de trabajo en tiempo de diseño</span><span class="sxs-lookup"><span data-stu-id="a39c3-149">Design-time working directory changed</span></span>

<span data-ttu-id="a39c3-150">Los cambios en ASP.NET Core 2.0 también requerían que el directorio de trabajo que usaba `dotnet ef` se alineara con el que usaba Visual Studio al ejecutar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a39c3-150">The ASP.NET Core 2.0 changes also required the working directory used by `dotnet ef` to align with the working directory used by Visual Studio when running your application.</span></span> <span data-ttu-id="a39c3-151">Un efecto secundario observable de esto es que los nombres de archivo de SQLite ahora se refieren al directorio del proyecto y no al de salida, como solía ser.</span><span class="sxs-lookup"><span data-stu-id="a39c3-151">One observable side effect of this is that SQLite filenames are now relative to the project directory and not the output directory like they used to be.</span></span>

## <a name="ef-core-20-requires-a-20-database-provider"></a><span data-ttu-id="a39c3-152">EF Core 2.0 requiere un proveedor de base de datos de la versión 2.0</span><span class="sxs-lookup"><span data-stu-id="a39c3-152">EF Core 2.0 requires a 2.0 database provider</span></span>

<span data-ttu-id="a39c3-153">Para EF Core 2.0, hemos realizado muchas simplificaciones y mejoras en el funcionamiento de los proveedores de bases de datos.</span><span class="sxs-lookup"><span data-stu-id="a39c3-153">For EF Core 2.0 we have made many simplifications and improvements in the way database providers work.</span></span> <span data-ttu-id="a39c3-154">Esto significa que los proveedores 1.0.x y 1.1.x no funcionarán con EF Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="a39c3-154">This means that 1.0.x and 1.1.x providers will not work with EF Core 2.0.</span></span>

<span data-ttu-id="a39c3-155">El equipo de EF envía los proveedores de SQL Server y SQLite, y las versiones 2.0 estarán disponibles como parte de la versión 2.0.</span><span class="sxs-lookup"><span data-stu-id="a39c3-155">The SQL Server and SQLite providers are shipped by the EF team and 2.0 versions will be available as part of the 2.0 release.</span></span> <span data-ttu-id="a39c3-156">Los proveedores de terceros de código abierto para [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL) y [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) se están actualizando a la versión 2.0.</span><span class="sxs-lookup"><span data-stu-id="a39c3-156">The open-source third party providers for [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), and [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) are being updated for 2.0.</span></span> <span data-ttu-id="a39c3-157">Para el resto de proveedores, póngase en contacto con el escritor en cuestión.</span><span class="sxs-lookup"><span data-stu-id="a39c3-157">For all other providers, please contact the provider writer.</span></span>

## <a name="logging-and-diagnostics-events-have-changed"></a><span data-ttu-id="a39c3-158">Cambios en los eventos de diagnóstico y registro</span><span class="sxs-lookup"><span data-stu-id="a39c3-158">Logging and Diagnostics events have changed</span></span>

<span data-ttu-id="a39c3-159">Nota: Estos cambios no deberían afectar a gran parte del código de aplicación.</span><span class="sxs-lookup"><span data-stu-id="a39c3-159">Note: these changes should not impact most application code.</span></span>

<span data-ttu-id="a39c3-160">Los id. de evento de los mensajes enviados a un elemento [ILogger](/dotnet/api/microsoft.extensions.logging.ilogger) han cambiado en la versión 2.0.</span><span class="sxs-lookup"><span data-stu-id="a39c3-160">The event IDs for messages sent to an [ILogger](/dotnet/api/microsoft.extensions.logging.ilogger) have changed in 2.0.</span></span> <span data-ttu-id="a39c3-161">Los identificadores de evento ahora son únicos en el código de EF Core.</span><span class="sxs-lookup"><span data-stu-id="a39c3-161">The event IDs are now unique across EF Core code.</span></span> <span data-ttu-id="a39c3-162">Ahora, estos mensajes también siguen el patrón estándar de registro estructurado que usa, por ejemplo, MVC.</span><span class="sxs-lookup"><span data-stu-id="a39c3-162">These messages now also follow the standard pattern for structured logging used by, for example, MVC.</span></span>

<span data-ttu-id="a39c3-163">Las categorías de registrador también han cambiado.</span><span class="sxs-lookup"><span data-stu-id="a39c3-163">Logger categories have also changed.</span></span> <span data-ttu-id="a39c3-164">Ahora hay un conjunto conocido de categorías a las que se accede a través de [DbLoggerCategory](https://github.com/aspnet/EntityFrameworkCore/blob/rel/2.0.0/src/EFCore/DbLoggerCategory.cs).</span><span class="sxs-lookup"><span data-stu-id="a39c3-164">There is now a well-known set of categories accessed through [DbLoggerCategory](https://github.com/aspnet/EntityFrameworkCore/blob/rel/2.0.0/src/EFCore/DbLoggerCategory.cs).</span></span>

<span data-ttu-id="a39c3-165">Los eventos [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) ahora usan los mismos nombres de id. de evento que los mensajes de `ILogger` correspondientes.</span><span class="sxs-lookup"><span data-stu-id="a39c3-165">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) events now use the same event ID names as the corresponding `ILogger` messages.</span></span> <span data-ttu-id="a39c3-166">Todas las cargas de evento son tipos nominales derivados de [EventData](/dotnet/api/microsoft.entityframeworkcore.diagnostics.eventdata).</span><span class="sxs-lookup"><span data-stu-id="a39c3-166">The event payloads are all nominal types derived from [EventData](/dotnet/api/microsoft.entityframeworkcore.diagnostics.eventdata).</span></span>

<span data-ttu-id="a39c3-167">Los id. de eventos, tipos de carga y categorías se documentan en las clases [CoreEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.coreeventid) y [RelationalEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.relationaleventid).</span><span class="sxs-lookup"><span data-stu-id="a39c3-167">Event IDs, payload types, and categories are documented in the [CoreEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.coreeventid) and the [RelationalEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.relationaleventid) classes.</span></span>

<span data-ttu-id="a39c3-168">Los id. también se han pasado de Microsoft.EntityFrameworkCore.Infrastructure al nuevo espacio de nombres Microsoft.EntityFrameworkCore.Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="a39c3-168">IDs have also moved from Microsoft.EntityFrameworkCore.Infrastructure to the new Microsoft.EntityFrameworkCore.Diagnostics namespace.</span></span>

## <a name="ef-core-relational-metadata-api-changes"></a><span data-ttu-id="a39c3-169">Cambios en la API de metadatos relacionales de EF Core</span><span class="sxs-lookup"><span data-stu-id="a39c3-169">EF Core relational metadata API changes</span></span>

<span data-ttu-id="a39c3-170">EF Core 2.0 ahora compila un elemento [IModel](/dotnet/api/microsoft.entityframeworkcore.metadata.imodel) diferente para cada proveedor que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="a39c3-170">EF Core 2.0 will now build a different [IModel](/dotnet/api/microsoft.entityframeworkcore.metadata.imodel) for each different provider being used.</span></span> <span data-ttu-id="a39c3-171">Esto suele ser transparente para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a39c3-171">This is usually transparent to the application.</span></span> <span data-ttu-id="a39c3-172">Esto ha permitido una simplificación de las API de metadatos de nivel inferior, de modo que cualquier acceso a _conceptos de metadatos relacionales comunes_ siempre se realiza mediante una llamada a `.Relational` en lugar de a `.SqlServer`, `.Sqlite`, etc. Por ejemplo, un código de 1.1.x similar al siguiente:</span><span class="sxs-lookup"><span data-stu-id="a39c3-172">This has facilitated a simplification of lower-level metadata APIs such that any access to _common relational metadata concepts_ is always made through a call to `.Relational` instead of `.SqlServer`, `.Sqlite`, etc. For example, 1.1.x code like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).SqlServer().TableName;
```

<span data-ttu-id="a39c3-173">Ahora debe escribirse de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="a39c3-173">Should now be written like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).Relational().TableName;
```

<span data-ttu-id="a39c3-174">En lugar de utilizar métodos como `ForSqlServerToTable`, los métodos de extensión ahora están disponibles para escribir código condicional basado en el proveedor actual en uso.</span><span class="sxs-lookup"><span data-stu-id="a39c3-174">Instead of using methods like `ForSqlServerToTable`, extension methods are now available to write conditional code based on the current provider in use.</span></span> <span data-ttu-id="a39c3-175">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="a39c3-175">For example:</span></span>

```csharp
modelBuilder.Entity<User>().ToTable(
    Database.IsSqlServer() ? "SqlServerName" : "OtherName");
```

<span data-ttu-id="a39c3-176">Tenga en cuenta que este cambio solo se aplica a las API o los metadatos que se definen para _todos_ los proveedores relacionales.</span><span class="sxs-lookup"><span data-stu-id="a39c3-176">Note that this change only applies to APIs/metadata that is defined for _all_ relational providers.</span></span> <span data-ttu-id="a39c3-177">La API y los metadatos siguen siendo los mismos cuando son específicos de un único proveedor.</span><span class="sxs-lookup"><span data-stu-id="a39c3-177">The API and metadata remains the same when it is specific to only a single provider.</span></span> <span data-ttu-id="a39c3-178">Por ejemplo, los índices en clúster son específicos de SQL Server, por lo que se deben seguir usando `ForSqlServerIsClustered` y `.SqlServer().IsClustered()`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-178">For example, clustered indexes are specific to SQL Sever, so `ForSqlServerIsClustered` and  `.SqlServer().IsClustered()` must still be used.</span></span>

## <a name="dont-take-control-of-the-ef-service-provider"></a><span data-ttu-id="a39c3-179">No tomar el control del proveedor de servicios de EF</span><span class="sxs-lookup"><span data-stu-id="a39c3-179">Don’t take control of the EF service provider</span></span>

<span data-ttu-id="a39c3-180">EF Core usa un elemento `IServiceProvider` interno (un contenedor de inserción de dependencias) para su implementación interna.</span><span class="sxs-lookup"><span data-stu-id="a39c3-180">EF Core uses an internal `IServiceProvider` (a dependency injection container) for its internal implementation.</span></span> <span data-ttu-id="a39c3-181">Las aplicaciones deben permitir que EF Core cree y administre este proveedor, excepto en casos especiales.</span><span class="sxs-lookup"><span data-stu-id="a39c3-181">Applications should allow EF Core to create and manage this provider except in special cases.</span></span> <span data-ttu-id="a39c3-182">Valore seriamente la posibilidad de quitar todas las llamadas a `UseInternalServiceProvider`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-182">Strongly consider removing any calls to `UseInternalServiceProvider`.</span></span> <span data-ttu-id="a39c3-183">Si una aplicación necesita llamar a `UseInternalServiceProvider`, sopese [tramitar una incidencia](https://github.com/dotnet/efcore/Issues) para que podamos investigar otras maneras de controlar su escenario.</span><span class="sxs-lookup"><span data-stu-id="a39c3-183">If an application does need to call `UseInternalServiceProvider`, then please consider [filing an issue](https://github.com/dotnet/efcore/Issues) so we can investigate other ways to handle your scenario.</span></span>

<span data-ttu-id="a39c3-184">El código de aplicación no requiere la llamada a `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. a menos que se llame también a `UseInternalServiceProvider`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-184">Calling `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. is not required by application code unless `UseInternalServiceProvider` is also called.</span></span> <span data-ttu-id="a39c3-185">Quite todas las llamadas existentes a `AddEntityFramework` o `AddEntityFrameworkSqlServer`, etc.; `AddDbContext` debe seguir utilizándose igual que antes.</span><span class="sxs-lookup"><span data-stu-id="a39c3-185">Remove any existing calls to `AddEntityFramework` or `AddEntityFrameworkSqlServer`, etc. `AddDbContext` should still be used in the same way as before.</span></span>

## <a name="in-memory-databases-must-be-named"></a><span data-ttu-id="a39c3-186">Obligatoriedad de nombre de las bases de datos en memoria</span><span class="sxs-lookup"><span data-stu-id="a39c3-186">In-memory databases must be named</span></span>

<span data-ttu-id="a39c3-187">La base de datos global en memoria sin nombre se ha quitado y, en su lugar, todas las bases de datos en memoria deben tener nombre.</span><span class="sxs-lookup"><span data-stu-id="a39c3-187">The global unnamed in-memory database has been removed and instead all in-memory databases must be named.</span></span> <span data-ttu-id="a39c3-188">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="a39c3-188">For example:</span></span>

``` csharp
optionsBuilder.UseInMemoryDatabase("MyDatabase");
```

<span data-ttu-id="a39c3-189">Esto crea o usa una base de datos con el nombre "MyDatabase".</span><span class="sxs-lookup"><span data-stu-id="a39c3-189">This creates/uses a database with the name “MyDatabase”.</span></span> <span data-ttu-id="a39c3-190">Si se llama de nuevo a `UseInMemoryDatabase` con el mismo nombre, se usará la misma base de datos en memoria, lo que permite que varias instancias de contexto lo compartan.</span><span class="sxs-lookup"><span data-stu-id="a39c3-190">If `UseInMemoryDatabase` is called again with the same name, then the same in-memory database will be used, allowing it to be shared by multiple context instances.</span></span>

## <a name="read-only-api-changes"></a><span data-ttu-id="a39c3-191">Cambios en la API de solo lectura</span><span class="sxs-lookup"><span data-stu-id="a39c3-191">Read-only API changes</span></span>

<span data-ttu-id="a39c3-192">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave` y `IsStoreGeneratedAlways` han quedado obsoletos y se han reemplazado por [BeforeSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.beforesavebehavior) y [AfterSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.aftersavebehavior).</span><span class="sxs-lookup"><span data-stu-id="a39c3-192">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`, and `IsStoreGeneratedAlways` have been obsoleted and replaced with [BeforeSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.beforesavebehavior) and [AfterSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.aftersavebehavior).</span></span> <span data-ttu-id="a39c3-193">Estos comportamientos se aplican a cualquier propiedad (no solo a las propiedades generadas por el almacén) y determinan cómo se debe usar el valor de la propiedad al insertarlo en una fila de base de datos (`BeforeSaveBehavior`) o al actualizar una fila de base de datos existente (`AfterSaveBehavior`).</span><span class="sxs-lookup"><span data-stu-id="a39c3-193">These behaviors apply to any property (not only store-generated properties) and determine how the value of the property should be used when inserting into a database row (`BeforeSaveBehavior`) or when updating an existing database row (`AfterSaveBehavior`).</span></span>

<span data-ttu-id="a39c3-194">Las propiedades marcadas como [ValueGenerated.OnAddOrUpdate](/dotnet/api/microsoft.entityframeworkcore.metadata.valuegenerated) (por ejemplo, para las columnas calculadas) omitirán de forma predeterminada cualquier valor establecido actualmente en la propiedad.</span><span class="sxs-lookup"><span data-stu-id="a39c3-194">Properties marked as [ValueGenerated.OnAddOrUpdate](/dotnet/api/microsoft.entityframeworkcore.metadata.valuegenerated) (for example, for computed columns) will by default ignore any value currently set on the property.</span></span> <span data-ttu-id="a39c3-195">Esto significa que siempre se obtendrá un valor generado por el almacén independientemente de si se ha establecido o modificado algún valor en la entidad de la que se realiza el seguimiento.</span><span class="sxs-lookup"><span data-stu-id="a39c3-195">This means that a store-generated value will always be obtained regardless of whether any value has been set or modified on the tracked entity.</span></span> <span data-ttu-id="a39c3-196">Esto se puede cambiar estableciendo un elemento `Before\AfterSaveBehavior` distinto.</span><span class="sxs-lookup"><span data-stu-id="a39c3-196">This can be changed by setting a different `Before\AfterSaveBehavior`.</span></span>

## <a name="new-clientsetnull-delete-behavior"></a><span data-ttu-id="a39c3-197">Comportamiento de eliminación de ClientSetNull nuevo</span><span class="sxs-lookup"><span data-stu-id="a39c3-197">New ClientSetNull delete behavior</span></span>

<span data-ttu-id="a39c3-198">En versiones anteriores, [DeleteBehavior.Restrict](/dotnet/api/microsoft.entityframeworkcore.deletebehavior) tenía un comportamiento para las entidades de las que el contexto realizaba un seguimiento que coincidía más estrechamente con la semántica `SetNull`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-198">In previous releases, [DeleteBehavior.Restrict](/dotnet/api/microsoft.entityframeworkcore.deletebehavior) had a behavior for entities tracked by the context that more closed matched `SetNull` semantics.</span></span> <span data-ttu-id="a39c3-199">En EF Core 2.0, se ha introducido un comportamiento de `ClientSetNull` nuevo como valor predeterminado para las relaciones opcionales.</span><span class="sxs-lookup"><span data-stu-id="a39c3-199">In EF Core 2.0, a new `ClientSetNull` behavior has been introduced as the default for optional relationships.</span></span> <span data-ttu-id="a39c3-200">Este comportamiento tiene la semántica `SetNull` para las entidades sometidas a seguimiento y el comportamiento `Restrict` para las bases de datos creadas mediante EF Core.</span><span class="sxs-lookup"><span data-stu-id="a39c3-200">This behavior has `SetNull` semantics for tracked entities and `Restrict` behavior for databases created using EF Core.</span></span> <span data-ttu-id="a39c3-201">La experiencia nos indica que estos son los comportamientos más esperados y útiles para las entidades sometidas a seguimiento y la base de datos.</span><span class="sxs-lookup"><span data-stu-id="a39c3-201">In our experience, these are the most expected/useful behaviors for tracked entities and the database.</span></span> <span data-ttu-id="a39c3-202">`DeleteBehavior.Restrict` ahora se admite para entidades sometidas a seguimiento cuando se establece para relaciones opcionales.</span><span class="sxs-lookup"><span data-stu-id="a39c3-202">`DeleteBehavior.Restrict` is now honored for tracked entities when set for optional relationships.</span></span>

## <a name="provider-design-time-packages-removed"></a><span data-ttu-id="a39c3-203">Eliminación de los paquetes en tiempo de diseño del proveedor</span><span class="sxs-lookup"><span data-stu-id="a39c3-203">Provider design-time packages removed</span></span>

<span data-ttu-id="a39c3-204">El paquete `Microsoft.EntityFrameworkCore.Relational.Design` se ha eliminado.</span><span class="sxs-lookup"><span data-stu-id="a39c3-204">The `Microsoft.EntityFrameworkCore.Relational.Design` package has been removed.</span></span> <span data-ttu-id="a39c3-205">Su contenido se ha consolidado en `Microsoft.EntityFrameworkCore.Relational` y `Microsoft.EntityFrameworkCore.Design`.</span><span class="sxs-lookup"><span data-stu-id="a39c3-205">It's contents were consolidated into `Microsoft.EntityFrameworkCore.Relational` and `Microsoft.EntityFrameworkCore.Design`.</span></span>

<span data-ttu-id="a39c3-206">Esto se propaga a los paquetes en tiempo de diseño del proveedor.</span><span class="sxs-lookup"><span data-stu-id="a39c3-206">This propagates into the provider design-time packages.</span></span> <span data-ttu-id="a39c3-207">Estos paquetes (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) se han quitado y su contenido se ha consolidado en los paquetes principales del proveedor.</span><span class="sxs-lookup"><span data-stu-id="a39c3-207">Those packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) were removed and their contents consolidated into the main provider packages.</span></span>

<span data-ttu-id="a39c3-208">Para habilitar `Scaffold-DbContext` o `dotnet ef dbcontext scaffold` en EF Core 2.0, solo tiene que hacer referencia al paquete del proveedor único:</span><span class="sxs-lookup"><span data-stu-id="a39c3-208">To enable `Scaffold-DbContext` or `dotnet ef dbcontext scaffold` in EF Core 2.0, you only need to reference the single provider package:</span></span>

``` xml
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer"
    Version="2.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools"
    Version="2.0.0"
    PrivateAssets="All" />
<DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
    Version="2.0.0" />
```
