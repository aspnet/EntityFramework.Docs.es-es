---
title: 'Información general sobre el registro y la interceptación: EF Core'
description: Información general sobre el registro, los eventos, los interceptores y el diagnóstico de EF Core
author: ajcvickers
ms.date: 10/01/2020
uid: core/logging-events-diagnostics/index
ms.openlocfilehash: fdf536dc6ec15e6e520d574b14527a4e7a7b1d72
ms.sourcegitcommit: f3512e3a98e685a3ba409c1d0157ce85cc390cf4
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/10/2020
ms.locfileid: "94431145"
---
# <a name="overview-of-logging-and-interception"></a><span data-ttu-id="cb3a1-103">Información general sobre el registro y la interceptación</span><span class="sxs-lookup"><span data-stu-id="cb3a1-103">Overview of Logging and Interception</span></span>

<span data-ttu-id="cb3a1-104">Entity Framework Core (EF Core) contiene varios mecanismos para generar registros, responder a eventos y obtener diagnósticos.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-104">Entity Framework Core (EF Core) contains several mechanisms for generating logs, responding to events, and obtaining diagnostics.</span></span> <span data-ttu-id="cb3a1-105">Cada uno de ellos se adapta a diferentes situaciones, y es importante seleccionar el mecanismo adecuado para cada tarea, incluso cuando puedan funcionar varios.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-105">Each of these is tailored to different situations, and it is important to select the best mechanism for the task in hand, even when multiple mechanisms could work.</span></span> <span data-ttu-id="cb3a1-106">Por ejemplo, un interceptor de base de datos se podría usar para registrar SQL, pero sería más adecuado usar en este caso alguno de los mecanismos adaptados al registro.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-106">For example, a database interceptor could be used to log SQL, but this is better handled by one of the mechanisms tailored to logging.</span></span> <span data-ttu-id="cb3a1-107">En esta página, se presenta información general de cada uno de estos mecanismos y se describe en qué casos se debe usar cada uno de ellos.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-107">This page presents an overview of each of these mechanisms and describes when each should be used.</span></span>

## <a name="quick-reference"></a><span data-ttu-id="cb3a1-108">Referencia rápida</span><span class="sxs-lookup"><span data-stu-id="cb3a1-108">Quick reference</span></span>

<span data-ttu-id="cb3a1-109">En la siguiente tabla se proporciona una referencia rápida para las diferencias entre los mecanismos descritos aquí.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-109">The table below provides a quick reference for the differences between the mechanisms described here.</span></span>

| <span data-ttu-id="cb3a1-110">Mechanism</span><span class="sxs-lookup"><span data-stu-id="cb3a1-110">Mechanism</span></span> |  <span data-ttu-id="cb3a1-111">Async</span><span class="sxs-lookup"><span data-stu-id="cb3a1-111">Async</span></span> | <span data-ttu-id="cb3a1-112">Ámbito</span><span class="sxs-lookup"><span data-stu-id="cb3a1-112">Scope</span></span> | <span data-ttu-id="cb3a1-113">Registrado</span><span class="sxs-lookup"><span data-stu-id="cb3a1-113">Registered</span></span> | <span data-ttu-id="cb3a1-114">Uso previsto</span><span class="sxs-lookup"><span data-stu-id="cb3a1-114">Intended use</span></span>
|:----------|--------|-------|------------|-------------
| <span data-ttu-id="cb3a1-115">Registro sencillo</span><span class="sxs-lookup"><span data-stu-id="cb3a1-115">Simple Logging</span></span> | <span data-ttu-id="cb3a1-116">No</span><span class="sxs-lookup"><span data-stu-id="cb3a1-116">No</span></span> | <span data-ttu-id="cb3a1-117">Por contexto</span><span class="sxs-lookup"><span data-stu-id="cb3a1-117">Per context</span></span> | <span data-ttu-id="cb3a1-118">Configuración en contexto</span><span class="sxs-lookup"><span data-stu-id="cb3a1-118">Context configuration</span></span> | <span data-ttu-id="cb3a1-119">Registro del tiempo de desarrollo</span><span class="sxs-lookup"><span data-stu-id="cb3a1-119">Development-time logging</span></span>
| <span data-ttu-id="cb3a1-120">Microsoft.Extensions.Logging</span><span class="sxs-lookup"><span data-stu-id="cb3a1-120">Microsoft.Extensions.Logging</span></span> | <span data-ttu-id="cb3a1-121">No</span><span class="sxs-lookup"><span data-stu-id="cb3a1-121">No</span></span> | <span data-ttu-id="cb3a1-122">Por contexto\*</span><span class="sxs-lookup"><span data-stu-id="cb3a1-122">Per context\*</span></span> | <span data-ttu-id="cb3a1-123">D.I.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-123">D.I.</span></span> <span data-ttu-id="cb3a1-124">o configuración en contexto</span><span class="sxs-lookup"><span data-stu-id="cb3a1-124">or context configuration</span></span> | <span data-ttu-id="cb3a1-125">Registro de producción</span><span class="sxs-lookup"><span data-stu-id="cb3a1-125">Production logging</span></span>
| <span data-ttu-id="cb3a1-126">Eventos</span><span class="sxs-lookup"><span data-stu-id="cb3a1-126">Events</span></span> | <span data-ttu-id="cb3a1-127">No</span><span class="sxs-lookup"><span data-stu-id="cb3a1-127">No</span></span> | <span data-ttu-id="cb3a1-128">Por contexto</span><span class="sxs-lookup"><span data-stu-id="cb3a1-128">Per context</span></span> | <span data-ttu-id="cb3a1-129">Cualquier momento</span><span class="sxs-lookup"><span data-stu-id="cb3a1-129">Any time</span></span> | <span data-ttu-id="cb3a1-130">Reacción a eventos de EF</span><span class="sxs-lookup"><span data-stu-id="cb3a1-130">Reacting to EF events</span></span>
| <span data-ttu-id="cb3a1-131">Interceptores</span><span class="sxs-lookup"><span data-stu-id="cb3a1-131">Interceptors</span></span> | <span data-ttu-id="cb3a1-132">Sí</span><span class="sxs-lookup"><span data-stu-id="cb3a1-132">Yes</span></span> | <span data-ttu-id="cb3a1-133">Por contexto</span><span class="sxs-lookup"><span data-stu-id="cb3a1-133">Per context</span></span> | <span data-ttu-id="cb3a1-134">Configuración en contexto</span><span class="sxs-lookup"><span data-stu-id="cb3a1-134">Context configuration</span></span> | <span data-ttu-id="cb3a1-135">Manipulación de operaciones EF</span><span class="sxs-lookup"><span data-stu-id="cb3a1-135">Manipulating EF operations</span></span>
| <span data-ttu-id="cb3a1-136">Escuchas de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="cb3a1-136">Diagnostics listeners</span></span> | <span data-ttu-id="cb3a1-137">No</span><span class="sxs-lookup"><span data-stu-id="cb3a1-137">No</span></span> | <span data-ttu-id="cb3a1-138">Proceso</span><span class="sxs-lookup"><span data-stu-id="cb3a1-138">Process</span></span> | <span data-ttu-id="cb3a1-139">Globalmente</span><span class="sxs-lookup"><span data-stu-id="cb3a1-139">Globally</span></span> | <span data-ttu-id="cb3a1-140">Diagnósticos de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="cb3a1-140">Application diagnostics</span></span>

<span data-ttu-id="cb3a1-141">\*Normalmente `Microsoft.Extensions.Logging` se configura por aplicación a través de la inserción de dependencias. Sin embargo, en el nivel de EF, cada contexto se _puede_ configurar con un registrador diferente en caso necesario.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-141">\*Typically `Microsoft.Extensions.Logging` is configured per-application via dependency injection However, at the EF level, each context _can_ be configured with a different logger if needed.</span></span>

## <a name="simple-logging"></a><span data-ttu-id="cb3a1-142">Registro sencillo</span><span class="sxs-lookup"><span data-stu-id="cb3a1-142">Simple logging</span></span>

> [!NOTE]
> <span data-ttu-id="cb3a1-143">Esta característica se agregó en EF Core 5.0.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-143">This feature was added in EF Core 5.0.</span></span>

<span data-ttu-id="cb3a1-144">Se puede acceder a los registros de EF Core desde cualquier tipo de aplicación mediante el uso de [LogTo](https://github.com/dotnet/efcore/blob/ec3df8fd7e4ea4ebeebfa747619cef37b23ab2c6/src/EFCore/DbContextOptionsBuilder.cs#L135)</span><span class="sxs-lookup"><span data-stu-id="cb3a1-144">EF Core logs can be accessed from any type of application through the use of [LogTo](https://github.com/dotnet/efcore/blob/ec3df8fd7e4ea4ebeebfa747619cef37b23ab2c6/src/EFCore/DbContextOptionsBuilder.cs#L135)</span></span> <!-- Issue #2748 <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder.LogTo%2A> --> <span data-ttu-id="cb3a1-145">al [configurar una instancia de DbContext](xref:core/dbcontext-configuration/index).</span><span class="sxs-lookup"><span data-stu-id="cb3a1-145">when [configuring a DbContext instance](xref:core/dbcontext-configuration/index).</span></span> <span data-ttu-id="cb3a1-146">Esta configuración se realiza normalmente en una invalidación de <xref:Microsoft.EntityFrameworkCore.DbContext.OnConfiguring%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-146">This configuration is commonly done in an override of <xref:Microsoft.EntityFrameworkCore.DbContext.OnConfiguring%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="cb3a1-147">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="cb3a1-147">For example:</span></span>

<!--
    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        => optionsBuilder.LogTo(Console.WriteLine);
-->
[!code-csharp[LogToConsole](../../../samples/core/Miscellaneous/Logging/SimpleLogging/Program.cs?name=LogToConsole)]

<span data-ttu-id="cb3a1-148">Este concepto es similar a <xref:System.Data.Entity.Database.Log?displayProperty=nameWithType> en EF6.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-148">This concept is similar to <xref:System.Data.Entity.Database.Log?displayProperty=nameWithType> in EF6.</span></span>

<span data-ttu-id="cb3a1-149">Vea [Registro simple](xref:core/logging-events-diagnostics/simple-logging) para más información.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-149">See [Simple Logging](xref:core/logging-events-diagnostics/simple-logging) for more information.</span></span>

## <a name="microsoftextensionslogging"></a><span data-ttu-id="cb3a1-150">Microsoft.Extensions.Logging</span><span class="sxs-lookup"><span data-stu-id="cb3a1-150">Microsoft.Extensions.Logging</span></span>

<span data-ttu-id="cb3a1-151">[Microsoft.Extensions.Logging](/dotnet/core/extensions/logging) es un mecanismo de registro extensible con proveedores de complementos para muchos sistemas de registro comunes.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-151">[Microsoft.Extensions.Logging](/dotnet/core/extensions/logging) is an extensible logging mechanism with plug-in providers for many common logging systems.</span></span> <span data-ttu-id="cb3a1-152">EF Core se integra totalmente con `Microsoft.Extensions.Logging` y esta forma de registro se usa de forma predeterminada para las aplicaciones ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-152">EF Core fully integrates with `Microsoft.Extensions.Logging` and this form of logging is used by default for ASP.NET Core applications.</span></span>

<span data-ttu-id="cb3a1-153">Consulte [Usar Microsoft.Extensions.Logging en EF Core](xref:core/logging-events-diagnostics/extensions-logging) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-153">See [Using Microsoft.Extensions.Logging in EF Core](xref:core/logging-events-diagnostics/extensions-logging) for more information.</span></span>

## <a name="events"></a><span data-ttu-id="cb3a1-154">Eventos</span><span class="sxs-lookup"><span data-stu-id="cb3a1-154">Events</span></span>

> [!NOTE]
> <span data-ttu-id="cb3a1-155">Se agregaron eventos adicionales en EF Core 5.0.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-155">Additional events were added in EF Core 5.0.</span></span>

<span data-ttu-id="cb3a1-156">EF Core expone [eventos de .NET](/dotnet/standard/events/) para que actúen como devoluciones de llamada cuando ocurran ciertas cosas en el código EF Core.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-156">EF Core exposes [.NET events](/dotnet/standard/events/) to act as callbacks when certain things happen in the EF Core code.</span></span> <span data-ttu-id="cb3a1-157">Los eventos son más sencillos que los interceptores y permiten un registro más flexible.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-157">Events are simpler than interceptors and allow more flexible registration.</span></span> <span data-ttu-id="cb3a1-158">Sin embargo, solo son sincrónicos y, por tanto, no pueden realizar operaciones de E/S asincrónicas sin bloqueo.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-158">However, they are sync only and so cannot perform non-blocking async I/O.</span></span>

<span data-ttu-id="cb3a1-159">Los eventos se registran por instancia de DbContext y este registro se puede realizar en cualquier momento.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-159">Events are registered per DbContext instance and this registration can be done at any time.</span></span> <span data-ttu-id="cb3a1-160">Use una [escucha de diagnóstico](xref:core/logging-events-diagnostics/diagnostic-listeners) para obtener la misma información, pero para todas las instancias de DbContext del proceso.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-160">Use a [diagnostic listener](xref:core/logging-events-diagnostics/diagnostic-listeners) to get the same information but for all DbContext instances in the process.</span></span>

<span data-ttu-id="cb3a1-161">Consulte [Eventos de .NET en EF Core](xref:core/logging-events-diagnostics/events) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-161">See [.NET Events in EF Core](xref:core/logging-events-diagnostics/events) for more information.</span></span>

## <a name="interception"></a><span data-ttu-id="cb3a1-162">Interception</span><span class="sxs-lookup"><span data-stu-id="cb3a1-162">Interception</span></span>

> [!NOTE]
> <span data-ttu-id="cb3a1-163">Esta característica se agregó en EF Core 3.0.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-163">This feature was added in EF Core 3.0.</span></span> <span data-ttu-id="cb3a1-164">Se agregaron interceptores adicionales en EF Core 5.0.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-164">Additional interceptors were added in EF Core 5.0.</span></span>

<span data-ttu-id="cb3a1-165">Los interceptores de EF Core habilitan la intercepción, la modificación o la supresión de operaciones de EF Core.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-165">EF Core interceptors enable interception, modification, and/or suppression of EF Core operations.</span></span> <span data-ttu-id="cb3a1-166">Esto incluye operaciones de base de datos de bajo nivel tales como ejecutar un comando, así como operaciones de nivel superior tales como llamadas a SaveChanges.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-166">This includes low-level database operations such as executing a command, as well as higher-level operations, such as calls to SaveChanges.</span></span>

<span data-ttu-id="cb3a1-167">Los interceptores son distintos del registro y el diagnóstico en que permiten la modificación o supresión de la operación que se intercepta.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-167">Interceptors are different from logging and diagnostics in that they allow modification or suppression of the operation being intercepted.</span></span> <span data-ttu-id="cb3a1-168">El [registro sencillo](xref:core/logging-events-diagnostics/simple-logging) o [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging) son mejores opciones de registro.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-168">[Simple logging](xref:core/logging-events-diagnostics/simple-logging) or [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging) are better choices for logging.</span></span>

<span data-ttu-id="cb3a1-169">Los interceptores se registran por instancia de DbContext al configurarse el contexto.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-169">Interceptors are registered per DbContext instance when the context is configured.</span></span> <span data-ttu-id="cb3a1-170">Use una [escucha de diagnóstico](xref:core/logging-events-diagnostics/diagnostic-listeners) para obtener la misma información, pero para todas las instancias de DbContext del proceso.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-170">Use a [diagnostic listener](xref:core/logging-events-diagnostics/diagnostic-listeners) to get the same information but for all DbContext instances in the process.</span></span>

<span data-ttu-id="cb3a1-171">Consulte [Interceptación](xref:core/logging-events-diagnostics/interceptors) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-171">See [Interception](xref:core/logging-events-diagnostics/interceptors) for more information.</span></span>

## <a name="diagnostic-listeners"></a><span data-ttu-id="cb3a1-172">Escuchas de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="cb3a1-172">Diagnostic listeners</span></span>

<span data-ttu-id="cb3a1-173">Las escuchas de diagnóstico permiten escuchar cualquier evento de EF Core que se produzca en el proceso de .NET actual.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-173">Diagnostic listeners allow listening for any EF Core event that occurs in the current .NET process.</span></span>

<span data-ttu-id="cb3a1-174">Las escuchas de diagnóstico no son adecuadas para obtener eventos de una sola instancia de DbContext.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-174">Diagnostic listeners are not suitable for getting events from a single DbContext instance.</span></span> <span data-ttu-id="cb3a1-175">Los interceptores de EF Core proporcionan acceso a los mismos eventos con el registro por contexto.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-175">EF Core interceptors provide access to the same events with per-context registration.</span></span>

<span data-ttu-id="cb3a1-176">Las escuchas de diagnóstico no están diseñadas para el registro.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-176">Diagnostic listeners are not designed for logging.</span></span> <span data-ttu-id="cb3a1-177">El [registro sencillo](xref:core/logging-events-diagnostics/simple-logging) o [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging) son mejores opciones de registro.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-177">[Simple logging](xref:core/logging-events-diagnostics/simple-logging) or [Microsoft.Extensions.Logging](xref:core/logging-events-diagnostics/extensions-logging) are better choices for logging.</span></span>

<span data-ttu-id="cb3a1-178">Consulte el artículo sobre cómo [Usar escuchas de diagnóstico en EF Core](xref:core/logging-events-diagnostics/diagnostic-listeners) para obtener más información.</span><span class="sxs-lookup"><span data-stu-id="cb3a1-178">See [Using diagnostic listeners in EF Core](xref:core/logging-events-diagnostics/diagnostic-listeners) for more information.</span></span>
