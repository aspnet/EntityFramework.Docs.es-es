---
title: 'Entidades de autoseguimiento: EF6'
author: divega
ms.date: 10/23/2016
ms.assetid: 5e60f5be-7bbb-4bf8-835e-0ac808d6c84a
ms.openlocfilehash: 3bb9759d89fbd0c10b911625aa7d0afd7747de14
ms.sourcegitcommit: 9b562663679854c37c05fca13d93e180213fb4aa
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 04/07/2020
ms.locfileid: "78413360"
---
# <a name="self-tracking-entities"></a><span data-ttu-id="e4e53-102">Entidades de autoseguimiento</span><span class="sxs-lookup"><span data-stu-id="e4e53-102">Self-tracking entities</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e4e53-103">Ya no se recomienda usar la plantilla Entidades de autoseguimiento.</span><span class="sxs-lookup"><span data-stu-id="e4e53-103">We no longer recommend using the self-tracking-entities template.</span></span> <span data-ttu-id="e4e53-104">Solo sigue estando disponible para la compatibilidad con las aplicaciones existentes.</span><span class="sxs-lookup"><span data-stu-id="e4e53-104">It will only continue to be available to support existing applications.</span></span> <span data-ttu-id="e4e53-105">Si la aplicación necesita trabajar con gráficos desconectados de entidades, considere otras alternativas, como [Trackable Entities](https://trackableentities.github.io/), que es una tecnología similar a Entidades de autoseguimiento pero que la comunidad desarrolla de forma más activa, o escriba código personalizado mediante la API de seguimiento de cambios de bajo nivel.</span><span class="sxs-lookup"><span data-stu-id="e4e53-105">If your application requires working with disconnected graphs of entities, consider other alternatives such as [Trackable Entities](https://trackableentities.github.io/), which is a technology similar to Self-Tracking-Entities that is more actively developed by the community, or writing custom code using the low-level change tracking APIs.</span></span>

<span data-ttu-id="e4e53-106">En una aplicación basada en Entity Framework, el responsable de realizar el seguimiento de los cambios en los objetos es un contexto.</span><span class="sxs-lookup"><span data-stu-id="e4e53-106">In an Entity Framework-based application, a context is responsible for tracking changes in your objects.</span></span> <span data-ttu-id="e4e53-107">Luego se usa el método SaveChanges para almacenar los cambios en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="e4e53-107">You then use the SaveChanges method to persist the changes to the database.</span></span> <span data-ttu-id="e4e53-108">Cuando se trabaja con aplicaciones de n niveles, los objetos de entidad generalmente están desconectados del contexto y es necesario decidir cómo realizar el seguimiento de los cambios y notificar esos cambios al contexto.</span><span class="sxs-lookup"><span data-stu-id="e4e53-108">When working with N-Tier applications, the entity objects are usually disconnected from the context and you must decide how to track changes and report those changes back to the context.</span></span> <span data-ttu-id="e4e53-109">Las entidades de autoseguimiento (STE) pueden ayudar a realizar el seguimiento de los cambios en cualquier nivel y luego reproducir estos cambios en un contexto que se vaya a guardar.</span><span class="sxs-lookup"><span data-stu-id="e4e53-109">Self-Tracking Entities (STEs) can help you track changes in any tier and then replay these changes into a context to be saved.</span></span>  

<span data-ttu-id="e4e53-110">Use STE solo si el contexto no está disponible en un nivel en el que se realizan cambios en el gráfico del objeto.</span><span class="sxs-lookup"><span data-stu-id="e4e53-110">Use STEs only if the context is not available on a tier where the changes to the object graph are made.</span></span> <span data-ttu-id="e4e53-111">Si el contexto está disponible, no hay necesidad de usar STE, ya que él mismo se encarga del seguimiento de los cambios.</span><span class="sxs-lookup"><span data-stu-id="e4e53-111">If the context is available, there is no need to use STEs because the context will take care of tracking changes.</span></span>  

<span data-ttu-id="e4e53-112">Este elemento de plantilla genera dos archivos .tt (plantilla de texto):</span><span class="sxs-lookup"><span data-stu-id="e4e53-112">This template item generates two .tt (text template) files:</span></span>  

- <span data-ttu-id="e4e53-113">El archivo **\<nombreDelModelo\>.tt** genera los tipos de entidad y una clase del asistente que contiene la lógica de seguimiento de cambios que usan las entidades de autoseguimiento y los métodos de extensión que permiten establecer el estado en las entidades de autoseguimiento.</span><span class="sxs-lookup"><span data-stu-id="e4e53-113">The **\<model name\>.tt** file generates the entity types and a helper class that contains the change-tracking logic that is used by self-tracking entities and the extension methods that allow setting state on self-tracking entities.</span></span>  
- <span data-ttu-id="e4e53-114">El archivo **\<nombreDelModelo\>.Context.tt** genera un contexto derivado y una clase de extensión que contiene métodos **ApplyChanges** para las clases **ObjectContext** y **ObjectSet**.</span><span class="sxs-lookup"><span data-stu-id="e4e53-114">The **\<model name\>.Context.tt** file generates a derived context and an extension class that contains **ApplyChanges** methods for the **ObjectContext** and **ObjectSet** classes.</span></span> <span data-ttu-id="e4e53-115">Estos métodos examinan la información del seguimiento de cambios contenida en el grafo de entidades con seguimiento propio para deducir el conjunto de operaciones que se deben realizar con el fin de guardar los cambios en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="e4e53-115">These methods examine the change-tracking information that is contained in the graph of self-tracking entities to infer the set of operations that must be performed to save the changes in the database.</span></span>  

## <a name="get-started"></a><span data-ttu-id="e4e53-116">Introducción</span><span class="sxs-lookup"><span data-stu-id="e4e53-116">Get Started</span></span>  

<span data-ttu-id="e4e53-117">Para comenzar, visite la página [Self-Tracking Entities Walkthrough](walkthrough.md) (Tutorial sobre entidades de autoseguimiento).</span><span class="sxs-lookup"><span data-stu-id="e4e53-117">To get started, visit the [Self-Tracking Entities Walkthrough](walkthrough.md) page.</span></span>  

## <a name="functional-considerations-when-working-with-self-tracking-entities"></a><span data-ttu-id="e4e53-118">Consideraciones funcionales al trabajar con entidades de seguimiento propio</span><span class="sxs-lookup"><span data-stu-id="e4e53-118">Functional Considerations When Working with Self-Tracking Entities</span></span>  
> [!IMPORTANT]
> <span data-ttu-id="e4e53-119">Ya no se recomienda usar la plantilla Entidades de autoseguimiento.</span><span class="sxs-lookup"><span data-stu-id="e4e53-119">We no longer recommend using the self-tracking-entities template.</span></span> <span data-ttu-id="e4e53-120">Solo sigue estando disponible para la compatibilidad con las aplicaciones existentes.</span><span class="sxs-lookup"><span data-stu-id="e4e53-120">It will only continue to be available to support existing applications.</span></span> <span data-ttu-id="e4e53-121">Si la aplicación necesita trabajar con gráficos desconectados de entidades, considere otras alternativas, como [Trackable Entities](https://trackableentities.github.io/), que es una tecnología similar a Entidades de autoseguimiento pero que la comunidad desarrolla de forma más activa, o escriba código personalizado mediante la API de seguimiento de cambios de bajo nivel.</span><span class="sxs-lookup"><span data-stu-id="e4e53-121">If your application requires working with disconnected graphs of entities, consider other alternatives such as [Trackable Entities](https://trackableentities.github.io/), which is a technology similar to Self-Tracking-Entities that is more actively developed by the community, or writing custom code using the low-level change tracking APIs.</span></span>

<span data-ttu-id="e4e53-122">Tenga en cuenta lo siguiente al trabajar con entidades de seguimiento propio:</span><span class="sxs-lookup"><span data-stu-id="e4e53-122">Consider the following when working with self-tracking entities:</span></span>  

- <span data-ttu-id="e4e53-123">Asegúrese de que el proyecto cliente tenga una referencia al ensamblado con los tipos de entidad.</span><span class="sxs-lookup"><span data-stu-id="e4e53-123">Make sure that your client project has a reference to the assembly containing the entity types.</span></span> <span data-ttu-id="e4e53-124">Si agrega solo la referencia de servicio al proyecto cliente, este proyecto usará los tipos de proxy WCF y no los tipos reales de entidad de seguimiento propio.</span><span class="sxs-lookup"><span data-stu-id="e4e53-124">If you add only the service reference to the client project, the client project will use the WCF proxy types and not the actual self-tracking entity types.</span></span> <span data-ttu-id="e4e53-125">Es decir, no obtendrá las características de notificación automatizadas que administran el seguimiento de las entidades en el cliente.</span><span class="sxs-lookup"><span data-stu-id="e4e53-125">This means that you will not get the automated notification features that manage the tracking of the entities on the client.</span></span> <span data-ttu-id="e4e53-126">Si, a propósito, no desea incluir los tipos de entidad, deberá establecer manualmente la información de seguimiento de cambios en el cliente de los cambios que se van a devolver al servicio.</span><span class="sxs-lookup"><span data-stu-id="e4e53-126">If you intentionally do not want to include the entity types, you will have to manually set change-tracking information on the client for the changes to be sent back to the service.</span></span>  
- <span data-ttu-id="e4e53-127">Las llamadas a la operación de servicio no deben tener estado y deben crear una nueva instancia del contexto del objeto.</span><span class="sxs-lookup"><span data-stu-id="e4e53-127">Calls to the service operation should be stateless and create a new instance of object context.</span></span> <span data-ttu-id="e4e53-128">Asimismo, se recomienda crear el contexto del objeto en un bloque **using**.</span><span class="sxs-lookup"><span data-stu-id="e4e53-128">We also recommend that you create object context in a **using** block.</span></span>  
- <span data-ttu-id="e4e53-129">Si envía el gráfico modificado en el cliente al servicio y luego planea seguir trabajando con el mismo gráfico en el cliente, debe iterar manualmente el gráfico y llamar al método **AcceptChanges** en cada objeto para restablecer la herramienta de seguimiento de cambios.</span><span class="sxs-lookup"><span data-stu-id="e4e53-129">When you send the graph that was modified on the client to the service and then intend to continue working with the same graph on the client, you have to manually iterate through the graph and call the **AcceptChanges** method on each object to reset the change tracker.</span></span>  

    > <span data-ttu-id="e4e53-130">Si los objetos del gráfico contienen propiedades con valores generados por la base de datos (por ejemplo, valores de identidad o simultaneidad), Entity Framework reemplaza los valores de estas propiedades por los valores generados por la base de datos después de llamar al método **SaveChanges**.</span><span class="sxs-lookup"><span data-stu-id="e4e53-130">If objects in your graph contain properties with database-generated values (for example, identity or concurrency values), Entity Framework will replace values of these properties with the database-generated values after the **SaveChanges** method is called.</span></span> <span data-ttu-id="e4e53-131">Puede implementar la operación del servicio para que devuelva objetos guardados o una lista de los valores de propiedad generados de los objetos devueltos al cliente.</span><span class="sxs-lookup"><span data-stu-id="e4e53-131">You can implement your service operation to return saved objects or a list of generated property values for the objects back to the client.</span></span> <span data-ttu-id="e4e53-132">El cliente debe reemplazar las instancias del objeto o los valores de propiedad del objeto con los objetos o los valores de propiedad devueltos desde la operación de servicio.</span><span class="sxs-lookup"><span data-stu-id="e4e53-132">The client would then need to replace the object instances or object property values with the objects or property values returned from the service operation.</span></span>  
- <span data-ttu-id="e4e53-133">Si se combinan gráficos de varias solicitudes de servicio, se pueden presentar objetos con valores de clave duplicada en el gráfico resultante.</span><span class="sxs-lookup"><span data-stu-id="e4e53-133">Merging graphs from multiple service requests may introduce objects with duplicate key values in the resulting graph.</span></span> <span data-ttu-id="e4e53-134">Entity Framework no quita los objetos con claves duplicadas cuando llama al método **ApplyChanges**, sino que produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="e4e53-134">Entity Framework does not remove the objects with duplicate keys when you call the **ApplyChanges** method but instead throws an exception.</span></span> <span data-ttu-id="e4e53-135">Para evitar tener gráficos con valores de clave duplicados, siga uno de los modelos descritos en el siguiente blog: [Self-Tracking Entities: ApplyChanges and duplicate entities](https://go.microsoft.com/fwlink/?LinkID=205119&clcid=0x409) (Entidades de autoseguimiento: ApplyChanges y entidades duplicadas).</span><span class="sxs-lookup"><span data-stu-id="e4e53-135">To avoid having graphs with duplicate key values follow one of the patterns described in the following blog: [Self-Tracking Entities: ApplyChanges and duplicate entities](https://go.microsoft.com/fwlink/?LinkID=205119&clcid=0x409).</span></span>  
- <span data-ttu-id="e4e53-136">Cuando se cambia la relación entre objetos mediante el establecimiento de la propiedad de clave externa, la propiedad de navegación de referencia se establece en NULL y no se sincroniza con la entidad de seguridad adecuada en el cliente.</span><span class="sxs-lookup"><span data-stu-id="e4e53-136">When you change the relationship between objects by setting the foreign key property, the reference navigation property is set to null and not synchronized to the appropriate principal entity on the client.</span></span> <span data-ttu-id="e4e53-137">Después de adjuntar el gráfico al contexto del objeto (por ejemplo, después de llamar al método **ApplyChanges**), se sincronizan las propiedades de clave externa y de navegación.</span><span class="sxs-lookup"><span data-stu-id="e4e53-137">After the graph is attached to the object context (for example, after you call the **ApplyChanges** method), the foreign key properties and navigation properties are synchronized.</span></span>  

    > <span data-ttu-id="e4e53-138">No disponer de ninguna propiedad de navegación de referencia sincronizada con el objeto principal adecuado podría representar un problema si ha especificado la eliminación en cascada en la relación de clave externa.</span><span class="sxs-lookup"><span data-stu-id="e4e53-138">Not having a reference navigation property synchronized with the appropriate principal object could be an issue if you have specified cascade delete on the foreign key relationship.</span></span> <span data-ttu-id="e4e53-139">Si elimina la entidad de seguridad, la eliminación no se propagará a los objetos dependientes.</span><span class="sxs-lookup"><span data-stu-id="e4e53-139">If you delete the principal, the delete will not be propagated to the dependent objects.</span></span> <span data-ttu-id="e4e53-140">Si ha especificado eliminaciones en cascada, use las propiedades de navegación para cambiar las relaciones en vez de establecer la propiedad de clave externa.</span><span class="sxs-lookup"><span data-stu-id="e4e53-140">If you have cascade deletes specified, use navigation properties to change relationships instead of setting the foreign key property.</span></span>  
- <span data-ttu-id="e4e53-141">Las entidades con seguimiento propio no están habilitadas para realizar una carga diferida.</span><span class="sxs-lookup"><span data-stu-id="e4e53-141">Self-tracking entities are not enabled to perform lazy loading.</span></span>  
- <span data-ttu-id="e4e53-142">La serialización binaria y la serialización a los objetos de administración de estado de ASP.NET no se admiten en las entidades de autoseguimiento.</span><span class="sxs-lookup"><span data-stu-id="e4e53-142">Binary serialization and serialization to ASP.NET state management objects is not supported by self-tracking entities.</span></span> <span data-ttu-id="e4e53-143">Sin embargo, puede personalizar la plantilla para agregar la compatibilidad de serialización binaria.</span><span class="sxs-lookup"><span data-stu-id="e4e53-143">However, you can customize the template to add the binary serialization support.</span></span> <span data-ttu-id="e4e53-144">Para obtener más información, vea [Using Binary Serialization and ViewState with Self-Tracking Entities](https://go.microsoft.com/fwlink/?LinkId=199208) (Uso de la serialización binaria y ViewState con entidades de autoseguimiento).</span><span class="sxs-lookup"><span data-stu-id="e4e53-144">For more information, see [Using Binary Serialization and ViewState with Self-Tracking Entities](https://go.microsoft.com/fwlink/?LinkId=199208).</span></span>  

## <a name="security-considerations"></a><span data-ttu-id="e4e53-145">Consideraciones sobre la seguridad</span><span class="sxs-lookup"><span data-stu-id="e4e53-145">Security Considerations</span></span>  

<span data-ttu-id="e4e53-146">Al trabajar con entidades de autoseguimiento, deben contemplarse las siguientes consideraciones de seguridad:</span><span class="sxs-lookup"><span data-stu-id="e4e53-146">The following security considerations should be taken into account when working with self-tracking entities:</span></span>  

- <span data-ttu-id="e4e53-147">Un servicio no debería confiar en solicitudes de recuperación o actualización de datos que proceden de un cliente que no es de plena confianza o transmitidas a través de un canal que no es de plena confianza.</span><span class="sxs-lookup"><span data-stu-id="e4e53-147">A service should not trust requests to retrieve or update data from a non-trusted client or through a non-trusted channel.</span></span> <span data-ttu-id="e4e53-148">Se debe autenticar un cliente: es necesario utilizar un canal seguro o la envoltura de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e4e53-148">A client must be authenticated: a secure channel or message envelope should be used.</span></span> <span data-ttu-id="e4e53-149">Se deben validar las solicitudes de los clientes de actualización o recuperación de datos para asegurarse de que se ajustan a los cambios legítimos y previstos del escenario dado.</span><span class="sxs-lookup"><span data-stu-id="e4e53-149">Clients' requests to update or retrieve data must be validated to ensure they conform to expected and legitimate changes for the given scenario.</span></span>  
- <span data-ttu-id="e4e53-150">Evite utilizar información confidencial como claves de entidad (por ejemplo, números de seguridad social).</span><span class="sxs-lookup"><span data-stu-id="e4e53-150">Avoid using sensitive information as entity keys (for example, social security numbers).</span></span> <span data-ttu-id="e4e53-151">Esto reduce la posibilidad de que pueda serializarse de forma inadvertida información confidencial en los grafos de entidades con seguimiento propio de un cliente que no es de plena confianza.</span><span class="sxs-lookup"><span data-stu-id="e4e53-151">This mitigates the possibility of inadvertently serializing sensitive information in the self-tracking entity graphs to a client that is not fully trusted.</span></span> <span data-ttu-id="e4e53-152">Con asociaciones independientes, se podría enviar también al cliente la clave original de una entidad que esté relacionada con la que se está serializando.</span><span class="sxs-lookup"><span data-stu-id="e4e53-152">With independent associations, the original key of an entity that is related to the one that is being serialized might be sent to the client as well.</span></span>  
- <span data-ttu-id="e4e53-153">Para evitar propagar mensajes de excepción con datos confidenciales en el nivel de cliente, las llamadas a **ApplyChanges** y **SaveChanges** en el nivel del servidor se deben encapsular en un código de control de excepciones.</span><span class="sxs-lookup"><span data-stu-id="e4e53-153">To avoid propagating exception messages that contain sensitive data to the client tier, calls to **ApplyChanges** and **SaveChanges** on the server tier should be wrapped in exception-handling code.</span></span>  
