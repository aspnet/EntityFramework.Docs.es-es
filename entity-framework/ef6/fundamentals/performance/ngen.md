---
title: Mejorar el rendimiento de inicio con NGen-EF6
author: divega
ms.date: 10/23/2016
ms.assetid: dc6110a0-80a0-4370-8190-cea942841cee
ms.openlocfilehash: 841aec645abdb2a56076d0b70bfb2614b0acafb4
ms.sourcegitcommit: 37d0e0fd1703467918665a64837dc54ad2ec7484
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/16/2019
ms.locfileid: "72445999"
---
# <a name="improving-startup-performance-with-ngen"></a><span data-ttu-id="dc8a0-102">Mejorar el rendimiento de inicio con NGen</span><span class="sxs-lookup"><span data-stu-id="dc8a0-102">Improving startup performance with NGen</span></span>
> [!NOTE]
> <span data-ttu-id="dc8a0-103">**Solo EF6 y versiones posteriores**: las características, las API, etc. que se tratan en esta página se han incluido a partir de Entity Framework 6.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-103">**EF6 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 6.</span></span> <span data-ttu-id="dc8a0-104">Si usa una versión anterior, no se aplica parte o la totalidad de la información.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-104">If you are using an earlier version, some or all of the information does not apply.</span></span>  

<span data-ttu-id="dc8a0-105">El .NET Framework admite la generación de imágenes nativas para aplicaciones y bibliotecas administradas como una manera de ayudar a las aplicaciones a iniciarse más rápido y, en algunos casos, usar menos memoria.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-105">The .NET Framework supports the generation of native images for managed applications and libraries as a way to help applications start faster and also in some cases use less memory.</span></span> <span data-ttu-id="dc8a0-106">Las imágenes nativas se crean mediante la conversión de ensamblados de código administrado en archivos que contienen instrucciones máquina nativas antes de que se ejecute la aplicación, lo que evita que el compilador JIT de .NET (Just-in-Time) tenga que generar las instrucciones nativas en tiempo de ejecución de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-106">Native images are created by translating managed code assemblies into files containing native machine instructions before the application is executed, relieving the .NET JIT (Just-In-Time) compiler from having to generate the native instructions at application runtime.</span></span>  

<span data-ttu-id="dc8a0-107">Antes de la versión 6, las bibliotecas principales del tiempo de ejecución de EF formaban parte del .NET Framework y las imágenes nativas se generaban automáticamente para ellas.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-107">Prior to version 6, the EF runtime’s core libraries were part of the .NET Framework and native images were generated automatically for them.</span></span> <span data-ttu-id="dc8a0-108">A partir de la versión 6, todo el tiempo de ejecución de EF se ha combinado en el paquete NuGet de EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-108">Starting with version 6 the whole EF runtime has been combined into the EntityFramework NuGet package.</span></span> <span data-ttu-id="dc8a0-109">Ahora, las imágenes nativas deben generarse con la herramienta de línea de comandos NGen. exe para obtener resultados similares.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-109">Native images have to now be generated using the NGen.exe command line tool to obtain similar results.</span></span>  

<span data-ttu-id="dc8a0-110">Las observaciones empíricas muestran que las imágenes nativas de los ensamblados en tiempo de ejecución de EF pueden cortar entre 1 y 3 segundos de tiempo de inicio de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-110">Empirical observations show that native images of the EF runtime assemblies can cut between 1 and 3 seconds of application startup time.</span></span>  

## <a name="how-to-use-ngenexe"></a><span data-ttu-id="dc8a0-111">Cómo usar NGen. exe</span><span class="sxs-lookup"><span data-stu-id="dc8a0-111">How to use NGen.exe</span></span>  

<span data-ttu-id="dc8a0-112">La función más básica de la herramienta NGen. exe es "instalar" (es decir, crear y conservar en disco) imágenes nativas para un ensamblado y todas sus dependencias directas.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-112">The most basic function of the NGen.exe tool is to “install” (that is, to create and persist to disk) native images for an assembly and all its direct dependencies.</span></span> <span data-ttu-id="dc8a0-113">Aquí se muestra cómo lograr esto:</span><span class="sxs-lookup"><span data-stu-id="dc8a0-113">Here is how you can achieve that:</span></span>  

1. <span data-ttu-id="dc8a0-114">Abra una ventana del símbolo del sistema como administrador.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-114">Open a Command Prompt window as an administrator.</span></span>
2. <span data-ttu-id="dc8a0-115">Cambie el directorio de trabajo actual a la ubicación de los ensamblados para los que desea generar imágenes nativas:</span><span class="sxs-lookup"><span data-stu-id="dc8a0-115">Change the current working directory to the location of the assemblies you want to generate native images for:</span></span>

   ``` console
   cd <*Assemblies location*>  
   ```

3. <span data-ttu-id="dc8a0-116">En función del sistema operativo y de la configuración de la aplicación, es posible que tenga que generar imágenes nativas para la arquitectura de 32 bits, la arquitectura de 64 bits o para ambas.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-116">Depending on your operating system and the application’s configuration you might need to generate native images for 32 bit architecture, 64 bit architecture or for both.</span></span>

   <span data-ttu-id="dc8a0-117">Para la ejecución de 32 bits:</span><span class="sxs-lookup"><span data-stu-id="dc8a0-117">For 32 bit run:</span></span>

   ``` console
   %WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install <Assembly name>  
   ```

   <span data-ttu-id="dc8a0-118">Para la ejecución de 64 bits:</span><span class="sxs-lookup"><span data-stu-id="dc8a0-118">For 64 bit run:</span></span>
  
   ``` console
   %WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install <Assembly name>  
   ```

> [!TIP]
> <span data-ttu-id="dc8a0-119">La generación de imágenes nativas para la arquitectura equivocada es un error muy común.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-119">Generating native images for the wrong architecture is a very common mistake.</span></span> <span data-ttu-id="dc8a0-120">En caso de duda, simplemente puede generar imágenes nativas para todas las arquitecturas que se aplican al sistema operativo instalado en la máquina.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-120">When in doubt you can simply generate native images for all the architectures that apply to the operating system installed in the machine.</span></span>  

<span data-ttu-id="dc8a0-121">NGen. exe también admite otras funciones, como desinstalar y mostrar las imágenes nativas instaladas, poner en cola la generación de varias imágenes, etc. Para obtener más detalles sobre el uso, lea la [documentación de Ngen. exe](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span><span class="sxs-lookup"><span data-stu-id="dc8a0-121">NGen.exe also supports other functions such as uninstalling and displaying the installed native images, queuing the generation of multiple images, etc. For more details of usage read the [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span></span>  

## <a name="when-to-use-ngenexe"></a><span data-ttu-id="dc8a0-122">Cuándo usar NGen. exe</span><span class="sxs-lookup"><span data-stu-id="dc8a0-122">When to use NGen.exe</span></span>  

<span data-ttu-id="dc8a0-123">Cuando se trata de decidir en qué ensamblados se van a generar imágenes nativas en una aplicación basada en EF versión 6 o versiones posteriores, debe tener en cuenta las siguientes opciones:</span><span class="sxs-lookup"><span data-stu-id="dc8a0-123">When it comes to decide which assemblies to generate native images for in an application based on EF version 6 or greater, you should consider the following options:</span></span>  

- <span data-ttu-id="dc8a0-124">**El ensamblado de tiempo de ejecución de EF principal, EntityFramework. dll**: una aplicación basada en EF típica ejecuta una cantidad significativa de código de este ensamblado en el inicio o en el primer acceso a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-124">**The main EF runtime assembly, EntityFramework.dll**: A typical EF based application executes a significant amount of code from this assembly on startup or on its first access to the database.</span></span> <span data-ttu-id="dc8a0-125">Por lo tanto, la creación de imágenes nativas de este ensamblado producirá las mayores mejoras en el rendimiento de inicio.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-125">Consequently, creating native images of this assembly will produce the biggest gains in startup performance.</span></span>  
- <span data-ttu-id="dc8a0-126">**Cualquier ensamblado de proveedor EF usado por la aplicación**: el tiempo de inicio también puede beneficiarse ligeramente de la generación de imágenes nativas.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-126">**Any EF provider assembly used by your application**: Startup time can also benefit slightly from generating native images of these.</span></span> <span data-ttu-id="dc8a0-127">Por ejemplo, si la aplicación utiliza el proveedor de EF para SQL Server querrá generar una imagen nativa para EntityFramework. SqlServer. dll.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-127">For example, if the application uses the EF provider for SQL Server you will want to generate a native image for EntityFramework.SqlServer.dll.</span></span>  
- <span data-ttu-id="dc8a0-128">**Los ensamblados de la aplicación y otras dependencias**: la [documentación de Ngen. exe](https://msdn.microsoft.com/library/6t9t5wcf.aspx) cubre los criterios generales para elegir en qué ensamblados se van a generar imágenes nativas y el impacto de las imágenes nativas en la seguridad, opciones avanzadas como "Hard enlace ", escenarios como el uso de imágenes nativas en escenarios de depuración y generación de perfiles, etc.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-128">**Your application’s assemblies and other dependencies**: The [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) covers general criteria for choosing which assemblies to generate native images for and the impact of native images on security, advanced options such as “hard binding”, scenarios such as using native images in debugging and profiling scenarios, etc.</span></span>  

> [!TIP]
> <span data-ttu-id="dc8a0-129">Asegúrese de medir cuidadosamente el impacto del uso de imágenes nativas en el rendimiento de inicio y el rendimiento general de la aplicación y compararlas con los requisitos reales.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-129">Make sure you carefully measure the impact of using native images on both the startup performance and the overall performance of your application and compare them against actual requirements.</span></span> <span data-ttu-id="dc8a0-130">Mientras que las imágenes nativas suelen ayudar a mejorar el rendimiento de inicio y, en algunos casos, reducir el uso de memoria, no todos los escenarios se beneficiarán de forma equitativa.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-130">While native images will generally help improve startup up performance and in some cases reduce memory usage, not all scenarios will benefit equally.</span></span> <span data-ttu-id="dc8a0-131">Por ejemplo, en la ejecución de estado estable (es decir, una vez que todos los métodos que se usan en la aplicación se han invocado al menos una vez), el código generado por el compilador JIT puede producir de hecho un rendimiento ligeramente mejor que las imágenes nativas.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-131">For instance, on steady state execution (that is, once all the methods being used by the application have been invoked at least once) code generated by the JIT compiler can in fact yield slightly better performance than native images.</span></span>  

## <a name="using-ngenexe-in-a-development-machine"></a><span data-ttu-id="dc8a0-132">Uso de NGen. exe en un equipo de desarrollo</span><span class="sxs-lookup"><span data-stu-id="dc8a0-132">Using NGen.exe in a development machine</span></span>  

<span data-ttu-id="dc8a0-133">Durante el desarrollo, el compilador JIT de .NET ofrecerá el mejor equilibrio general para el código que cambia con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-133">During development the .NET JIT compiler will offer the best overall tradeoff for code that is changing frequently.</span></span> <span data-ttu-id="dc8a0-134">La generación de imágenes nativas para las dependencias compiladas, como los ensamblados en tiempo de ejecución de EF, puede ayudar a acelerar el desarrollo y las pruebas reduciendo unos pocos segundos al principio de cada ejecución.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-134">Generating native images for compiled dependencies such as the EF runtime assemblies can help accelerate development and testing by cutting a few seconds out at the beginning of each execution.</span></span>  

<span data-ttu-id="dc8a0-135">Un buen lugar para encontrar los ensamblados en tiempo de ejecución de EF es la ubicación del paquete NuGet para la solución.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-135">A good place to find the EF runtime assemblies is the NuGet package location for the solution.</span></span> <span data-ttu-id="dc8a0-136">Por ejemplo, para una aplicación que usa EF 6.0.2 con SQL Server y con .NET 4,5 o superior como destino, puede escribir lo siguiente en una ventana del símbolo del sistema (Recuerde abrirla como administrador):</span><span class="sxs-lookup"><span data-stu-id="dc8a0-136">For example, for an application using EF 6.0.2 with SQL Server and targeting .NET 4.5 or greater you can type the following in a Command Prompt window (remember to open it as an administrator):</span></span>  

```console
cd <Solution directory>\packages\EntityFramework.6.0.2\lib\net45
%WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install EntityFramework.SqlServer.dll
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install EntityFramework.SqlServer.dll
```  

> [!NOTE]
> <span data-ttu-id="dc8a0-137">Esto aprovecha el hecho de que la instalación de imágenes nativas para el proveedor de EF para SQL Server también instalará de forma predeterminada las imágenes nativas para el ensamblado de tiempo de ejecución de EF principal.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-137">This takes advantage of the fact that installing the native images for EF provider for SQL Server will also by default install the native images for the main EF runtime assembly.</span></span> <span data-ttu-id="dc8a0-138">Esto funciona porque NGen. exe puede detectar que EntityFramework. dll es una dependencia directa del ensamblado EntityFramework. SqlServer. dll que se encuentra en el mismo directorio.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-138">This works because NGen.exe can detect that EntityFramework.dll is a direct dependency of the EntityFramework.SqlServer.dll assembly located in the same directory.</span></span>  

## <a name="creating-native-images-during-setup"></a><span data-ttu-id="dc8a0-139">Crear imágenes nativas durante la instalación</span><span class="sxs-lookup"><span data-stu-id="dc8a0-139">Creating native images during setup</span></span>  

<span data-ttu-id="dc8a0-140">El kit de herramientas de WiX permite poner en cola la generación de imágenes nativas para los ensamblados administrados durante la instalación, como se explica en esta [Guía de procedimientos](https://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span><span class="sxs-lookup"><span data-stu-id="dc8a0-140">The WiX Toolkit supports queuing the generation of native images for managed assemblies during setup, as explained in this [how-to guide](https://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span></span> <span data-ttu-id="dc8a0-141">Otra alternativa es crear una tarea de instalación personalizada que ejecute el comando NGen. exe.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-141">Another alternative is to create a custom setup task that execute the NGen.exe command.</span></span>  

## <a name="verifying-that-native-images-are-being-used-for-ef"></a><span data-ttu-id="dc8a0-142">Comprobando que las imágenes nativas se usan para EF</span><span class="sxs-lookup"><span data-stu-id="dc8a0-142">Verifying that native images are being used for EF</span></span>  

<span data-ttu-id="dc8a0-143">Para comprobar que una aplicación específica está utilizando un ensamblado nativo, busque los ensamblados cargados que tengan la extensión ". ni. dll" o ". ni. exe".</span><span class="sxs-lookup"><span data-stu-id="dc8a0-143">You can verify that a specific application is using a native assembly by looking for loaded assemblies that have the extension “.ni.dll” or “.ni.exe”.</span></span> <span data-ttu-id="dc8a0-144">Por ejemplo, una imagen nativa para el ensamblado en tiempo de ejecución principal de EF se denominará EntityFramework. ni. dll.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-144">For example, a native image for the EF’s main runtime assembly will be called EntityFramework.ni.dll.</span></span> <span data-ttu-id="dc8a0-145">Una manera sencilla de inspeccionar los ensamblados .NET cargados de un proceso es usar el [Explorador de procesos](https://technet.microsoft.com/sysinternals/bb896653).</span><span class="sxs-lookup"><span data-stu-id="dc8a0-145">An easy way to inspect the loaded .NET assemblies of a process is to use [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span></span>  

## <a name="other-things-to-be-aware-of"></a><span data-ttu-id="dc8a0-146">Otras cosas que debe tener en cuenta</span><span class="sxs-lookup"><span data-stu-id="dc8a0-146">Other things to be aware of</span></span>  

<span data-ttu-id="dc8a0-147">**No se debe confundir la creación de una imagen nativa de un ensamblado con el registro del ensamblado en la [GAC (caché global de ensamblados)](https://msdn.microsoft.com/library/yf1d93sz.aspx)** .</span><span class="sxs-lookup"><span data-stu-id="dc8a0-147">**Creating a native image of an assembly should not be confused with registering the assembly in the [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span></span> <span data-ttu-id="dc8a0-148">NGen. exe permite crear imágenes de ensamblados que no se encuentran en la GAC y, de hecho, varias aplicaciones que usan una versión específica de EF pueden compartir la misma imagen nativa.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-148">NGen.exe allows creating images of assemblies that are not in the GAC, and in fact, multiple applications that use a specific version of EF can share the same native image.</span></span> <span data-ttu-id="dc8a0-149">Aunque Windows 8 puede crear automáticamente imágenes nativas para los ensamblados colocados en la GAC, el tiempo de ejecución de EF se optimiza para implementarse junto con la aplicación y no se recomienda registrarlo en la GAC, ya que esto tiene un impacto negativo en la resolución de ensamblados. mantenimiento de las aplicaciones entre otros aspectos.</span><span class="sxs-lookup"><span data-stu-id="dc8a0-149">While Windows 8 can automatically create native images for assemblies placed in the GAC, the EF runtime is optimized to be deployed alongside your application and we do not recommend registering it in the GAC as this has a negative impact on assembly resolution and servicing your applications among other aspects.</span></span>  
